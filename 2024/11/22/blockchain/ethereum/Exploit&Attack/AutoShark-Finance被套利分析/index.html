<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="事件总结与影响  此次事件“攻击者”通过闪电贷借出大量BNB再利用SHARK合约逻辑漏洞操纵BNB-SHARK池来获得大量SHARK，最后把获得的SHARK兑换成BNB获利 用户质押的SHARK数量没有损失 因为生成了大量的SHARK然后将其抛售导致SHARK价格下跌，官方给的数据是从1.2跌倒0.01，目前的价格如下图：   事件信息 AutoShark官方提供：AutoShark如何被经济利用">
<meta property="og:type" content="article">
<meta property="og:title" content="AutoShark Finance被套利分析">
<meta property="og:url" content="https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="滴水成涓">
<meta property="og:description" content="事件总结与影响  此次事件“攻击者”通过闪电贷借出大量BNB再利用SHARK合约逻辑漏洞操纵BNB-SHARK池来获得大量SHARK，最后把获得的SHARK兑换成BNB获利 用户质押的SHARK数量没有损失 因为生成了大量的SHARK然后将其抛售导致SHARK价格下跌，官方给的数据是从1.2跌倒0.01，目前的价格如下图：   事件信息 AutoShark官方提供：AutoShark如何被经济利用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210528145633368.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210604175515326.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210526161635589.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210526163530873.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210526163723014.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210528154858329.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210528154659796.png">
<meta property="article:published_time" content="2024-11-22T06:32:06.491Z">
<meta property="article:modified_time" content="2024-11-22T06:32:06.491Z">
<meta property="article:author" content="guozhe">
<meta property="article:tag" content="blockchain">
<meta property="article:tag" content="ethereum">
<meta property="article:tag" content="solidity">
<meta property="article:tag" content="智能合约">
<meta property="article:tag" content="Exploit&amp;Attack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210528145633368.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>AutoShark Finance被套利分析</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="滴水成涓" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/guozhe001">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2024/11/22/blockchain/ethereum/Exploit&Attack/Belt%20Finance%E4%BA%8B%E4%BB%B6%E5%88%86%E6%9E%90/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2024/11/22/blockchain/ethereum/Exploit&Attack/XVS%E6%B8%85%E7%AE%97%E4%BA%8B%E4%BB%B6/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&text=AutoShark Finance被套利分析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&title=AutoShark Finance被套利分析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&is_video=false&description=AutoShark Finance被套利分析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=AutoShark Finance被套利分析&body=Check out this article: https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&title=AutoShark Finance被套利分析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&title=AutoShark Finance被套利分析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&title=AutoShark Finance被套利分析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&title=AutoShark Finance被套利分析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&name=AutoShark Finance被套利分析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&t=AutoShark Finance被套利分析"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BB%93%E4%B8%8E%E5%BD%B1%E5%93%8D"><span class="toc-number">1.</span> <span class="toc-text">事件总结与影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">2.</span> <span class="toc-text">事件信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">事件分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BA%86%E6%96%B9%E4%BE%BF%E5%88%86%E6%9E%90%EF%BC%8C%E6%88%91%E7%BB%99%E6%B6%89%E5%8F%8A%E5%88%B0%E7%9A%84%E5%9C%B0%E5%9D%80%E6%89%93%E4%B8%8A%E4%BA%86%E5%AF%B9%E5%BA%94%E7%9A%84%E5%8A%9F%E8%83%BD%E6%A0%87%E7%AD%BE%EF%BC%9A"><span class="toc-number">3.1.</span> <span class="toc-text">为了方便分析，我给涉及到的地址打上了对应的功能标签：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%94%BB%E5%87%BB%E8%80%85%E4%BB%8E-Pancake-%E7%9A%84-WBNB-BUSD-%E4%BA%A4%E6%98%93%E5%AF%B9%E4%B8%AD%E5%80%9F%E5%87%BA%E5%A4%A7%E9%87%8F-WBNB%EF%BC%9B"><span class="toc-number">3.2.</span> <span class="toc-text">1. 攻击者从 Pancake 的 WBNB&#x2F;BUSD 交易对中借出大量 WBNB；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%B0%86%E7%AC%AC-1-%E6%AD%A5%E5%80%9F%E5%87%BA%E7%9A%84%E5%85%A8%E9%83%A8-WBNB-%E4%B8%AD%E7%9A%84%E4%B8%80%E5%8D%8A%E9%80%9A%E8%BF%87-Panther-%E7%9A%84-SHARK-WBNB-%E4%BA%A4%E6%98%93%E5%AF%B9%E5%85%91%E6%8D%A2%E5%87%BA%E5%A4%A7%E9%87%8F%E7%9A%84-SHARK%EF%BC%8C%E5%90%8C%E6%97%B6%E6%B1%A0%E4%B8%AD-WBNB-%E7%9A%84%E6%95%B0%E9%87%8F%E5%A2%9E%E5%A4%9A%EF%BC%9B"><span class="toc-number">3.3.</span> <span class="toc-text">2. 将第 1 步借出的全部 WBNB 中的一半通过 Panther 的 SHARK&#x2F;WBNB 交易对兑换出大量的 SHARK，同时池中 WBNB 的数量增多；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%B0%86%E7%AC%AC-1-%E6%AD%A5%E5%92%8C%E7%AC%AC-2-%E6%AD%A5%E7%9A%84-WBNB-%E5%92%8C-SHARK-%E6%89%93%E5%85%A5%E5%88%B0-SharkMinter-%E4%B8%AD%EF%BC%8C%E4%B8%BA%E5%90%8E%E7%BB%AD%E6%94%BB%E5%87%BB%E5%81%9A%E5%87%86%E5%A4%87%EF%BC%9B"><span class="toc-number">3.4.</span> <span class="toc-text">3. 将第 1 步和第 2 步的 WBNB 和 SHARK 打入到 SharkMinter 中，为后续攻击做准备；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%B0%83%E7%94%A8-AutoShark-%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84-WBNB-SHARK-%E7%AD%96%E7%95%A5%E6%B1%A0%E4%B8%AD%E7%9A%84-getReward-%E5%87%BD%E6%95%B0%EF%BC%8C%E8%AF%A5%E5%87%BD%E6%95%B0%E4%BC%9A%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E8%8E%B7%E5%88%A9%E7%9A%84%E8%B5%84%E9%87%91%E4%BB%8E%E4%B8%AD%E6%8A%BD%E5%87%BA%E4%B8%80%E9%83%A8%E5%88%86%E6%89%8B%E7%BB%AD%E8%B4%B9%EF%BC%8C%E4%BD%9C%E4%B8%BA%E8%B4%A1%E7%8C%AE%E5%80%BC%E7%BB%99%E7%94%A8%E6%88%B7%E5%A5%96%E5%8A%B1-SHARK-%E4%BB%A3%E5%B8%81%EF%BC%8C%E8%BF%99%E9%83%A8%E5%88%86%E6%93%8D%E4%BD%9C%E5%9C%A8-SharkMinter-%E5%90%88%E7%BA%A6%E4%B8%AD%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%EF%BC%9B"><span class="toc-number">3.5.</span> <span class="toc-text">4. 调用 AutoShark 项目中的 WBNB&#x2F;SHARK 策略池中的 getReward 函数，该函数会根据用户获利的资金从中抽出一部分手续费，作为贡献值给用户奖励 SHARK 代币，这部分操作在 SharkMinter 合约中进行操作；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-SharkMinter-%E5%90%88%E7%BA%A6%E5%9C%A8%E6%94%B6%E5%88%B0%E7%94%A8%E6%88%B7%E6%94%B6%E7%9B%8A%E7%9A%84-LP-%E6%89%8B%E7%BB%AD%E8%B4%B9%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BC%9A%E5%B0%86-LP-%E9%87%8D%E6%96%B0%E6%8B%86%E6%88%90%E5%AF%B9%E5%BA%94%E7%9A%84-WBNB-%E5%92%8C-SHARK%EF%BC%8C%E9%87%8D%E6%96%B0%E5%8A%A0%E5%85%A5%E5%88%B0-Panther-%E7%9A%84-WBNB-SHARK-%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%EF%BC%9B"><span class="toc-number">3.6.</span> <span class="toc-text">5. SharkMinter 合约在收到用户收益的 LP 手续费之后，会将 LP 重新拆成对应的 WBNB 和 SHARK，重新加入到 Panther 的 WBNB&#x2F;SHARK 交易池中；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E7%94%B1%E4%BA%8E%E7%AC%AC-3-%E6%AD%A5%E6%94%BB%E5%87%BB%E8%80%85%E5%B7%B2%E7%BB%8F%E4%BA%8B%E5%85%88%E5%B0%86%E5%AF%B9%E5%BA%94%E7%9A%84%E4%BB%A3%E5%B8%81%E6%89%93%E5%85%A5%E5%88%B0-SharkMinter-%E5%90%88%E7%BA%A6%E4%B8%AD%EF%BC%8CSharkMinter-%E5%90%88%E7%BA%A6%E5%9C%A8%E7%A7%BB%E9%99%A4%E6%B5%81%E5%8A%A8%E6%80%A7%E5%90%8E%E5%86%8D%E6%B7%BB%E5%8A%A0%E6%B5%81%E5%8A%A8%E6%80%A7%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AF-SharkMinter-%E5%90%88%E7%BA%A6%E6%9C%AC%E8%BA%AB%E7%9A%84-WBNB-%E5%92%8C-SHARK-%E4%BD%99%E9%A2%9D%E8%BF%9B%E8%A1%8C%E6%B7%BB%E5%8A%A0%EF%BC%8C%E8%BF%99%E9%83%A8%E5%88%86%E4%BD%99%E9%A2%9D%E5%8C%85%E5%90%AB%E6%94%BB%E5%87%BB%E8%80%85%E5%9C%A8%E7%AC%AC-3-%E6%AD%A5%E6%89%93%E5%85%A5-SharkMinter-%E7%9A%84%E4%BD%99%E9%A2%9D%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%9C%80%E5%90%8E%E5%90%88%E7%BA%A6%E8%8E%B7%E5%8F%96%E7%9A%84%E6%B7%BB%E5%8A%A0%E6%B5%81%E5%8A%A8%E6%80%A7%E7%9A%84%E4%BD%99%E9%A2%9D%E6%98%AF%E9%94%99%E8%AF%AF%E7%9A%84%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4-SharkMinter-%E5%90%88%E7%BA%A6%E8%AF%AF%E4%BB%A5%E4%B8%BA%E6%94%BB%E5%87%BB%E8%80%85%E6%89%93%E5%85%A5%E4%BA%86%E5%B7%A8%E9%87%8F%E7%9A%84%E6%89%8B%E7%BB%AD%E8%B4%B9%E5%88%B0%E5%90%88%E7%BA%A6%E4%B8%AD%EF%BC%9B"><span class="toc-number">3.7.</span> <span class="toc-text">6. 由于第 3 步攻击者已经事先将对应的代币打入到 SharkMinter 合约中，SharkMinter 合约在移除流动性后再添加流动性的时候，使用的是 SharkMinter 合约本身的 WBNB 和 SHARK 余额进行添加，这部分余额包含攻击者在第 3 步打入 SharkMinter 的余额，导致最后合约获取的添加流动性的余额是错误的，也就是说 SharkMinter 合约误以为攻击者打入了巨量的手续费到合约中；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-SharkMinter-%E5%90%88%E7%BA%A6%E5%9C%A8%E8%8E%B7%E5%8F%96%E5%88%B0%E6%89%8B%E7%BB%AD%E8%B4%B9%E7%9A%84%E6%95%B0%E9%87%8F%E5%90%8E%EF%BC%8C%E4%BC%9A%E9%80%9A%E8%BF%87-tvlInWBNB-%E5%87%BD%E6%95%B0%E8%AE%A1%E7%AE%97%E8%BF%99%E9%83%A8%E5%88%86%E6%89%8B%E7%BB%AD%E8%B4%B9%E7%9A%84%E4%BB%B7%E5%80%BC%EF%BC%8C%E7%84%B6%E5%90%8E%E6%A0%B9%E6%8D%AE%E6%89%8B%E7%BB%AD%E8%B4%B9%E7%9A%84%E4%BB%B7%E5%80%BC%E9%93%B8%E5%B8%81-SHARK-%E4%BB%A3%E5%B8%81%E7%BB%99%E7%94%A8%E6%88%B7%E3%80%82%E4%BD%86%E6%98%AF%E5%9C%A8%E8%AE%A1%E7%AE%97-LP-%E4%BB%B7%E5%80%BC%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AF-Panther-WBNB-SHARK-%E6%B1%A0%E7%9A%84-WBNB-%E5%AE%9E%E6%97%B6%E6%95%B0%E9%87%8F%E9%99%A4%E4%BB%A5-LP-%E6%80%BB%E9%87%8F%E6%9D%A5%E8%AE%A1%E7%AE%97-LP-%E8%83%BD%E5%85%91%E6%8D%A2%E5%A4%9A%E5%B0%91-WBNB%E3%80%82%E4%BD%86%E6%98%AF%E7%94%B1%E4%BA%8E%E5%9C%A8%E7%AC%AC-2-%E6%AD%A5%E4%B8%AD%EF%BC%8CPanther-%E6%B1%A0%E4%B8%AD-WBNB-%E7%9A%84%E6%95%B0%E9%87%8F%E5%B7%B2%E7%BB%8F%E9%9D%9E%E5%B8%B8%E5%A4%9A%EF%BC%8C%E5%AF%BC%E8%87%B4%E8%AE%A1%E7%AE%97%E5%87%BA%E6%9D%A5%E7%9A%84-LP-%E7%9A%84%E4%BB%B7%E5%80%BC%E9%9D%9E%E5%B8%B8%E9%AB%98%EF%BC%9B"><span class="toc-number">3.8.</span> <span class="toc-text">7. SharkMinter 合约在获取到手续费的数量后，会通过 tvlInWBNB 函数计算这部分手续费的价值，然后根据手续费的价值铸币 SHARK 代币给用户。但是在计算 LP 价值的时候，使用的是 Panther WBNB&#x2F;SHARK 池的 WBNB 实时数量除以 LP 总量来计算 LP 能兑换多少 WBNB。但是由于在第 2 步中，Panther 池中 WBNB 的数量已经非常多，导致计算出来的 LP 的价值非常高；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E5%9C%A8-LP-%E4%BB%B7%E5%80%BC%E9%94%99%E8%AF%AF%E5%92%8C%E6%89%8B%E7%BB%AD%E8%B4%B9%E8%8E%B7%E5%8F%96%E6%95%B0%E9%87%8F%E9%94%99%E8%AF%AF%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8CSharkMinter-%E5%90%88%E7%BA%A6%E6%9C%80%E5%90%8E%E5%9C%A8%E8%AE%A1%E7%AE%97%E6%94%BB%E5%87%BB%E8%80%85%E7%9A%84%E8%B4%A1%E7%8C%AE%E7%9A%84%E6%97%B6%E5%80%99%E8%AE%A1%E7%AE%97%E5%87%BA%E4%BA%86%E4%B8%80%E4%B8%AA%E9%9D%9E%E5%B8%B8%E5%A4%A7%E7%9A%84%E5%80%BC%EF%BC%8C%E5%AF%BC%E8%87%B4-SharkMinter-%E5%90%88%E7%BA%A6%E7%BB%99%E6%94%BB%E5%87%BB%E8%80%85%E9%93%B8%E5%87%BA%E4%BA%86%E5%A4%A7%E9%87%8F%E7%9A%84-SHARK-%E4%BB%A3%E5%B8%81%EF%BC%9B"><span class="toc-number">3.9.</span> <span class="toc-text">8. 在 LP 价值错误和手续费获取数量错误的情况下，SharkMinter 合约最后在计算攻击者的贡献的时候计算出了一个非常大的值，导致 SharkMinter 合约给攻击者铸出了大量的 SHARK 代币；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E6%94%BB%E5%87%BB%E8%80%85%E5%90%8E%E7%BB%AD%E9%80%9A%E8%BF%87%E5%8D%96%E5%87%BA-SHARK-%E4%BB%A3%E5%B8%81%E6%9D%A5%E6%8D%A2%E5%87%BA-WBNB%EF%BC%8C%E5%81%BF%E8%BF%98%E9%97%AA%E7%94%B5%E8%B4%B7%E3%80%82%E7%84%B6%E5%90%8E%E8%8E%B7%E5%88%A9%E7%A6%BB%E5%BC%80%E3%80%82"><span class="toc-number">3.10.</span> <span class="toc-text">9. 攻击者后续通过卖出 SHARK 代币来换出 WBNB，偿还闪电贷。然后获利离开。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%BB%93%E6%9E%9C"><span class="toc-number">4.</span> <span class="toc-text">事件处理结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AutoShark%E5%AE%98%E6%96%B9%E7%BB%99%E7%9A%84%E8%A1%A5%E5%81%BF%E8%AE%A1%E5%88%92%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">AutoShark官方给的补偿计划：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PantherSwap%E5%85%B3%E5%81%9C%E6%89%80%E6%9C%89-SHARK%E7%9A%84LP%E6%B1%A0"><span class="toc-number">4.2.</span> <span class="toc-text">PantherSwap关停所有$SHARK的LP池</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        AutoShark Finance被套利分析
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">guozhe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-11-22T06:32:06.491Z" itemprop="datePublished">2024-11-22</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">blockchain</a> › <a class="category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/">ethereum</a> › <a class="category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/Exploit-Attack/">Exploit&Attack</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Exploit-Attack/" rel="tag">Exploit&Attack</a>, <a class="tag-link-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">blockchain</a>, <a class="tag-link-link" href="/tags/ethereum/" rel="tag">ethereum</a>, <a class="tag-link-link" href="/tags/solidity/" rel="tag">solidity</a>, <a class="tag-link-link" href="/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" rel="tag">智能合约</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="事件总结与影响">事件总结与影响</h3>
<ol>
<li>此次事件“攻击者”通过闪电贷借出大量BNB再利用SHARK合约逻辑漏洞操纵BNB-SHARK池来获得大量SHARK，最后把获得的SHARK兑换成BNB获利</li>
<li>用户质押的SHARK数量没有损失</li>
<li>因为生成了大量的SHARK然后将其抛售导致SHARK价格下跌，官方给的数据是从1.2跌倒0.01，目前的价格如下图：</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210528145633368.png" alt></p>
<h3 id="事件信息">事件信息</h3>
<p><a target="_blank" rel="noopener" href="https://medium.com/autosharkfin/how-autoshark-got-economically-exploited-3c644de5073a">AutoShark官方提供：AutoShark如何被经济利用</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jinse.com/news/blockchain/1099838.html">慢雾：AutoShark Finance 被黑分析</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/lGl4mkk4MAwxaNSPeFcfYw">PeckShield分析</a></p>
<p><a target="_blank" rel="noopener" href="https://bscscan.com/tx/0xfbe65ad3eed6b28d59bf6043debf1166d3420d214020ef54f12d2e0583a66f13">交易信息</a></p>
<p><a target="_blank" rel="noopener" href="https://pantherswap.com/">pantherswap</a></p>
<p><a target="_blank" rel="noopener" href="https://autoshark.finance/">autoshark.finance</a></p>
<p><a target="_blank" rel="noopener" href="https://exchange.pancakeswap.finance/#/swap">pancakeswap</a></p>
<p>当前项目正在审计中，由<a target="_blank" rel="noopener" href="https://www.watchpug.org/">WatchPug</a>公司<br>
<img src="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210604175515326.png" alt></p>
<h3 id="事件分析">事件分析</h3>
<p>这里直接复用<a target="_blank" rel="noopener" href="https://www.jinse.com/news/blockchain/1099838.html">慢雾安全团队</a>的分析步骤，我会结合token的流转和源码和具体的合约地址等再进一步解释。</p>
<h4 id="为了方便分析，我给涉及到的地址打上了对应的功能标签：">为了方便分析，我给涉及到的地址打上了对应的功能标签：</h4>
<table>
<thead>
<tr>
<th>address对应的tag</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td><a target="_blank" rel="noopener" href="https://bscscan.com/address/0xd9c7efe29f3e90ce3630ea1c665217c7ab298a3b">AS-Exploiter</a></td>
<td>AutoShark-Exploiter的地址</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://bscscan.com/address/0x58f876857a02d6762e0101bb5c46a8c1ed44dc16">Pancake-WBNB-BUSD-LP</a></td>
<td>Pancake的WBNB-BUSD流动池，是本次事件的入口，在这个LP闪电贷的BNB</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://bscscan.com/address/0x22de6648685e4e47fd944e68b264e0e0667e2e00">AS-Exploiter-Contract</a></td>
<td>AutoShark-Exploiter创建的合约地址</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://bscscan.com/address/0x1fd789fa513871cb89aa655f11ec777cad1784a0">Panther-SHARK-BNB-LP</a></td>
<td>Panther的SHARK-BNB流动池</td>
</tr>
</tbody>
</table>
<p>攻击步骤如下：</p>
<h4 id="1-攻击者从-Pancake-的-WBNB-BUSD-交易对中借出大量-WBNB；">1. 攻击者从 Pancake 的 WBNB/BUSD 交易对中借出大量 WBNB；</h4>
<p>对应的交易中的token转移如下：<br>
<img src="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210526161635589.png" alt></p>
<p>此处是通过调用<a target="_blank" rel="noopener" href="https://bscscan.com/address/0x58f876857a02d6762e0101bb5c46a8c1ed44dc16">Pancake-WBNB-BUSD-LP</a>合约的<code>swap</code>方法来实现的，具体代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; this low-level function should be called from a contract which performs important safety checks</span><br><span class="line">function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data) external lock &#123;</span><br><span class="line">    &#x2F;&#x2F; 至少有一个token兑换出的金额大于0</span><br><span class="line">    require(amount0Out &gt; 0 || amount1Out &gt; 0, &#39;Pancake: INSUFFICIENT_OUTPUT_AMOUNT&#39;);</span><br><span class="line">    &#x2F;&#x2F; 获取当前lp池中的两个token的储备数量</span><br><span class="line">    (uint112 _reserve0, uint112 _reserve1,) &#x3D; getReserves(); &#x2F;&#x2F; gas savings</span><br><span class="line">    &#x2F;&#x2F; 兑换出的token数量必须小于当前池中的token数量</span><br><span class="line">    require(amount0Out &lt; _reserve0 &amp;&amp; amount1Out &lt; _reserve1, &#39;Pancake: INSUFFICIENT_LIQUIDITY&#39;);</span><br><span class="line"></span><br><span class="line">    uint balance0;</span><br><span class="line">    uint balance1;</span><br><span class="line">    &#123; &#x2F;&#x2F; scope for _token&#123;0,1&#125;, avoids stack too deep errors</span><br><span class="line">    address _token0 &#x3D; token0;</span><br><span class="line">    address _token1 &#x3D; token1;</span><br><span class="line">    &#x2F;&#x2F; 接收兑换token的地址不能是当前lp池中的token中的任意一个</span><br><span class="line">    require(to !&#x3D; _token0 &amp;&amp; to !&#x3D; _token1, &#39;Pancake: INVALID_TO&#39;);</span><br><span class="line">    &#x2F;&#x2F; 如果token0兑换出的金额大于0，则把amount0Out转账给指定的地址to</span><br><span class="line">    if (amount0Out &gt; 0) _safeTransfer(_token0, to, amount0Out); &#x2F;&#x2F; optimistically transfer tokens</span><br><span class="line">    if (amount1Out &gt; 0) _safeTransfer(_token1, to, amount1Out); &#x2F;&#x2F; optimistically transfer tokens</span><br><span class="line">    &#x2F;&#x2F; 如果参数data不为空，则调用合约to的pancakeCall方法；接下来就是合约to的表演了</span><br><span class="line">    if (data.length &gt; 0) IPancakeCallee(to).pancakeCall(msg.sender, amount0Out, amount1Out, data);</span><br><span class="line">    &#x2F;&#x2F; 当合约to表演完之后，分别获取当前lp在两个token中的余额</span><br><span class="line">    balance0 &#x3D; IERC20(_token0).balanceOf(address(this));</span><br><span class="line">    balance1 &#x3D; IERC20(_token1).balanceOf(address(this));</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; 如果新的余额大于（当前存储量-兑换出的数量），则amount0In等于新的余额 - （当前存储量-兑换出的数量）</span><br><span class="line">    &#x2F;&#x2F; amount0In和amount1In是在计算实际进来了多少</span><br><span class="line">    uint amount0In &#x3D; balance0 &gt; _reserve0 - amount0Out ? balance0 - (_reserve0 - amount0Out) : 0;</span><br><span class="line">    uint amount1In &#x3D; balance1 &gt; _reserve1 - amount1Out ? balance1 - (_reserve1 - amount1Out) : 0;</span><br><span class="line">    &#x2F;&#x2F; 如果两个都是0，说明新的balance都不大于（存储量-兑换出的金额）；这说明没有进来，那么就报错；</span><br><span class="line">    &#x2F;&#x2F; 其实这个校验是在说打给当前lp池的token数量必须大于兑换出去的数量</span><br><span class="line">    require(amount0In &gt; 0 || amount1In &gt; 0, &#39;Pancake: INSUFFICIENT_INPUT_AMOUNT&#39;);</span><br><span class="line">    &#123; &#x2F;&#x2F; scope for reserve&#123;0,1&#125;Adjusted, avoids stack too deep errors</span><br><span class="line">    &#x2F;&#x2F; 计算调整后的balance，此处会收取千分之二的费用</span><br><span class="line">    uint balance0Adjusted &#x3D; balance0.mul(1000).sub(amount0In.mul(2));</span><br><span class="line">    uint balance1Adjusted &#x3D; balance1.mul(1000).sub(amount1In.mul(2));</span><br><span class="line">    &#x2F;&#x2F; 调用此方法后的两个token的积必须大于等于原始储备的两个token的积；即还回来的token在收完手续费之后必须大于借出去的</span><br><span class="line">    require(balance0Adjusted.mul(balance1Adjusted) &gt;&#x3D; uint(_reserve0).mul(_reserve1).mul(1000**2), &#39;Pancake: K&#39;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _update(balance0, balance1, _reserve0, _reserve1);</span><br><span class="line">    emit Swap(msg.sender, amount0In, amount1In, amount0Out, amount1Out, to);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>本地事件的第一步就是调用swap，入参如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Function: swap(uint256 amount0Out, uint256 amount1Out, address to, bytes data) ***</span><br><span class="line"></span><br><span class="line">MethodID: 0x022c0d9f</span><br><span class="line">[0]:  00000000000000000000000000000000000000000000152d02c7e14af6800000</span><br><span class="line">[1]:  0000000000000000000000000000000000000000000000000000000000000000</span><br><span class="line">[2]:  00000000000000000000000022de6648685e4e47fd944e68b264e0e0667e2e00</span><br><span class="line">[3]:  0000000000000000000000000000000000000000000000000000000000000080</span><br><span class="line">[4]:  0000000000000000000000000000000000000000000000000000000000000001</span><br><span class="line">[5]:  0100000000000000000000000000000000000000000000000000000000000000</span><br></pre></td></tr></table></figure>
<p>前面的三个参数是在描述“兑换100000个BNB和0个BUSD给<a target="_blank" rel="noopener" href="https://bscscan.com/address/0x22de6648685e4e47fd944e68b264e0e0667e2e00">AS-Exploiter-Contract</a>”，然后因为<code>data</code>参数不为空，所以会调用<a target="_blank" rel="noopener" href="https://bscscan.com/address/0x22de6648685e4e47fd944e68b264e0e0667e2e00">AS-Exploiter-Contract</a>合于的<code>pancakeCall</code>方法。</p>
<h4 id="2-将第-1-步借出的全部-WBNB-中的一半通过-Panther-的-SHARK-WBNB-交易对兑换出大量的-SHARK，同时池中-WBNB-的数量增多；">2. 将第 1 步借出的全部 WBNB 中的一半通过 Panther 的 SHARK/WBNB 交易对兑换出大量的 SHARK，同时池中 WBNB 的数量增多；</h4>
<p>对应的交易中的token转移如下：<br>
<img src="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210526163530873.png" alt></p>
<p>此处是一个兑换动作，调用合约的话其实有多种方式实现，下面是一种实现方式，调用<code>PantherPair.sol</code>的<code>swapExactTokensForTokens</code>方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function swapExactTokensForTokens(</span><br><span class="line">    uint amountIn,</span><br><span class="line">    uint amountOutMin,</span><br><span class="line">    address[] calldata path,</span><br><span class="line">    address to,</span><br><span class="line">    uint deadline</span><br><span class="line">) external virtual override ensure(deadline) returns (uint[] memory amounts) &#123;</span><br><span class="line">    amounts &#x3D; PantherLibrary.getAmountsOut(factory, amountIn, path);</span><br><span class="line">    require(amounts[amounts.length - 1] &gt;&#x3D; amountOutMin, &#39;PantherRouter: INSUFFICIENT_OUTPUT_AMOUNT&#39;);</span><br><span class="line">    TransferHelper.safeTransferFrom(</span><br><span class="line">        path[0], msg.sender, PantherLibrary.pairFor(factory, path[0], path[1]), amounts[0]</span><br><span class="line">    );</span><br><span class="line">    _swap(amounts, path, to);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-将第-1-步和第-2-步的-WBNB-和-SHARK-打入到-SharkMinter-中，为后续攻击做准备；">3. 将第 1 步和第 2 步的 WBNB 和 SHARK 打入到 SharkMinter 中，为后续攻击做准备；</h4>
<p><img src="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210526163723014.png" alt></p>
<h4 id="4-调用-AutoShark-项目中的-WBNB-SHARK-策略池中的-getReward-函数，该函数会根据用户获利的资金从中抽出一部分手续费，作为贡献值给用户奖励-SHARK-代币，这部分操作在-SharkMinter-合约中进行操作；">4. 调用 AutoShark 项目中的 WBNB/SHARK 策略池中的 getReward 函数，该函数会根据用户获利的资金从中抽出一部分手续费，作为贡献值给用户奖励 SHARK 代币，这部分操作在 SharkMinter 合约中进行操作；</h4>
<h4 id="5-SharkMinter-合约在收到用户收益的-LP-手续费之后，会将-LP-重新拆成对应的-WBNB-和-SHARK，重新加入到-Panther-的-WBNB-SHARK-交易池中；">5. SharkMinter 合约在收到用户收益的 LP 手续费之后，会将 LP 重新拆成对应的 WBNB 和 SHARK，重新加入到 Panther 的 WBNB/SHARK 交易池中；</h4>
<h4 id="6-由于第-3-步攻击者已经事先将对应的代币打入到-SharkMinter-合约中，SharkMinter-合约在移除流动性后再添加流动性的时候，使用的是-SharkMinter-合约本身的-WBNB-和-SHARK-余额进行添加，这部分余额包含攻击者在第-3-步打入-SharkMinter-的余额，导致最后合约获取的添加流动性的余额是错误的，也就是说-SharkMinter-合约误以为攻击者打入了巨量的手续费到合约中；">6. 由于第 3 步攻击者已经事先将对应的代币打入到 SharkMinter 合约中，SharkMinter 合约在移除流动性后再添加流动性的时候，使用的是 SharkMinter 合约本身的 WBNB 和 SHARK 余额进行添加，这部分余额包含攻击者在第 3 步打入 SharkMinter 的余额，导致最后合约获取的添加流动性的余额是错误的，也就是说 SharkMinter 合约误以为攻击者打入了巨量的手续费到合约中；</h4>
<h4 id="7-SharkMinter-合约在获取到手续费的数量后，会通过-tvlInWBNB-函数计算这部分手续费的价值，然后根据手续费的价值铸币-SHARK-代币给用户。但是在计算-LP-价值的时候，使用的是-Panther-WBNB-SHARK-池的-WBNB-实时数量除以-LP-总量来计算-LP-能兑换多少-WBNB。但是由于在第-2-步中，Panther-池中-WBNB-的数量已经非常多，导致计算出来的-LP-的价值非常高；">7. SharkMinter 合约在获取到手续费的数量后，会通过 tvlInWBNB 函数计算这部分手续费的价值，然后根据手续费的价值铸币 SHARK 代币给用户。但是在计算 LP 价值的时候，使用的是 Panther WBNB/SHARK 池的 WBNB 实时数量除以 LP 总量来计算 LP 能兑换多少 WBNB。但是由于在第 2 步中，Panther 池中 WBNB 的数量已经非常多，导致计算出来的 LP 的价值非常高；</h4>
<p>对应的<code>SharkMinter</code>方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function mintFor(address flip, uint _withdrawalFee, uint _performanceFee, address to, uint, uint boostRate) override external onlyMinter returns(uint mintAmount) &#123;</span><br><span class="line">    uint feeSum &#x3D; _performanceFee.add(_withdrawalFee);</span><br><span class="line">    uint tax &#x3D; 0;</span><br><span class="line">    if (flip &#x3D;&#x3D; address(PANTHER)) &#123;</span><br><span class="line">        tax &#x3D; feeSum.mul(PANTHER.transferTaxRate()).div(10000);</span><br><span class="line">    &#125;</span><br><span class="line">    IBEP20(flip).safeTransferFrom(msg.sender, address(this), feeSum.sub(tax).sub(1));</span><br><span class="line"></span><br><span class="line">    uint sharkBNBAmount &#x3D; tokenToSharkBNB(flip, IBEP20(flip).balanceOf(address(this)));</span><br><span class="line">    address flipToken &#x3D; sharkBNBFlipToken();</span><br><span class="line">    IBEP20(flipToken).safeTransfer(sharkPool, sharkBNBAmount);</span><br><span class="line">    IStakingRewards(sharkPool).notifyRewardAmount(sharkBNBAmount);</span><br><span class="line">    &#x2F;&#x2F; 这里计算的贡献变大了</span><br><span class="line">    uint contribution &#x3D; helper.tvlInBNB(flipToken, sharkBNBAmount).mul(_performanceFee).div(feeSum);</span><br><span class="line">    &#x2F;&#x2F; 所以计算出的要铸造的shark的数量也变大了</span><br><span class="line">    uint mintShark &#x3D; amountSharkToMint(contribution).mul(boostRate).div(10000);</span><br><span class="line">    mint(mintShark, to);</span><br><span class="line">    mintAmount &#x3D; mintShark;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>合约<code>StrategyHelperV1</code>的<code>tvlInBNB</code>方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function tvlInBNB(address _flip, uint amount) override public view returns (uint) &#123;</span><br><span class="line">    if (_flip &#x3D;&#x3D; address(PANTHER)) &#123;</span><br><span class="line">        return pantherPriceInBNB().mul(amount).div(1e18);</span><br><span class="line">    &#125;</span><br><span class="line">    address _token0 &#x3D; IPantherPair(_flip).token0();</span><br><span class="line">    address _token1 &#x3D; IPantherPair(_flip).token1();</span><br><span class="line">    if (_token0 &#x3D;&#x3D; address(WBNB) || _token1 &#x3D;&#x3D; address(WBNB)) &#123;</span><br><span class="line">        &#x2F;&#x2F; _flip是lp，因为此交易对的bnb很多，所以在得到的bnb就很大</span><br><span class="line">        uint bnb &#x3D; WBNB.balanceOf(address(_flip)).mul(amount).div(IBEP20(_flip).totalSupply());</span><br><span class="line">        return bnb.mul(2);</span><br><span class="line">    &#125;</span><br><span class="line">    uint balanceToken0 &#x3D; IBEP20(_token0).balanceOf(_flip);</span><br><span class="line">    &#x2F;&#x2F; 因为之前使用大量的bnb兑换token，导致price变大了</span><br><span class="line">    uint price &#x3D; tokenPriceInBNB(_token0);</span><br><span class="line">    &#x2F;&#x2F; (((balanceToken0 * price) &#x2F; 1e18) * 2 * amount) &#x2F; totalSupply</span><br><span class="line">    return balanceToken0.mul(price).div(1e18).mul(2).mul(amount).div(IBEP20(_flip).totalSupply());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="8-在-LP-价值错误和手续费获取数量错误的情况下，SharkMinter-合约最后在计算攻击者的贡献的时候计算出了一个非常大的值，导致-SharkMinter-合约给攻击者铸出了大量的-SHARK-代币；">8. 在 LP 价值错误和手续费获取数量错误的情况下，SharkMinter 合约最后在计算攻击者的贡献的时候计算出了一个非常大的值，导致 SharkMinter 合约给攻击者铸出了大量的 SHARK 代币；</h4>
<p>对应的交易中的token转移如下：图中从0地址到SharkMinter就是在铸造大量的SHARK。</p>
<p><img src="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210528154858329.png" alt></p>
<h4 id="9-攻击者后续通过卖出-SHARK-代币来换出-WBNB，偿还闪电贷。然后获利离开。">9. 攻击者后续通过卖出 SHARK 代币来换出 WBNB，偿还闪电贷。然后获利离开。</h4>
<p>对应的交易中的token转移如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210528154659796.png" alt></p>
<p>此步骤的操作逻辑比较简单，主要是调用<a target="_blank" rel="noopener" href="https://bscscan.com/address/0x1fd789fa513871cb89aa655f11ec777cad1784a0#code">Panther-SHARK-BNB-LP</a>合约的<code>swapTokensForExactTokens</code>方法；然后再把WBNB转给Pancake 的 WBNB/BUSD 交易对（调用<a target="_blank" rel="noopener" href="https://bscscan.com/address/0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c">WBNB</a>的<code>transfer</code>方法）来偿还闪电贷。</p>
<h3 id="事件处理结果">事件处理结果</h3>
<h4 id="AutoShark官方给的补偿计划："><a target="_blank" rel="noopener" href="https://medium.com/autosharkfin/how-autoshark-got-economically-exploited-3c644de5073a">AutoShark官方给的补偿计划</a>：</h4>
<ol>
<li>使用新的代币$JAW代替原来的$SHARK</li>
<li>以<a target="_blank" rel="noopener" href="https://bscscan.com/block/7698695">被攻击前一个区块</a>作为快照将$JAW分配给此时的$SHARK持有人</li>
<li>在180天里将所有金库的盈利的30%给$JAW的持有者</li>
<li>之前每铸造100个$SHARK，然后再额外铸造15个$SHARK给研发人员；接下来的60天里每铸造100个$JAW将其中的15个$JAW给$JAW的持有者。</li>
<li>将在PantherSwap平台发起IPO所得的部分BNB分配给$JAW持有者（金额没说）</li>
<li>将自己平台持有的所有$SHARK全部销毁</li>
<li>集成ChainLink的资产报价</li>
</ol>
<h4 id="PantherSwap关停所有-SHARK的LP池">PantherSwap关停所有$SHARK的LP池</h4>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/guozhe001">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BB%93%E4%B8%8E%E5%BD%B1%E5%93%8D"><span class="toc-number">1.</span> <span class="toc-text">事件总结与影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">2.</span> <span class="toc-text">事件信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">事件分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BA%86%E6%96%B9%E4%BE%BF%E5%88%86%E6%9E%90%EF%BC%8C%E6%88%91%E7%BB%99%E6%B6%89%E5%8F%8A%E5%88%B0%E7%9A%84%E5%9C%B0%E5%9D%80%E6%89%93%E4%B8%8A%E4%BA%86%E5%AF%B9%E5%BA%94%E7%9A%84%E5%8A%9F%E8%83%BD%E6%A0%87%E7%AD%BE%EF%BC%9A"><span class="toc-number">3.1.</span> <span class="toc-text">为了方便分析，我给涉及到的地址打上了对应的功能标签：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%94%BB%E5%87%BB%E8%80%85%E4%BB%8E-Pancake-%E7%9A%84-WBNB-BUSD-%E4%BA%A4%E6%98%93%E5%AF%B9%E4%B8%AD%E5%80%9F%E5%87%BA%E5%A4%A7%E9%87%8F-WBNB%EF%BC%9B"><span class="toc-number">3.2.</span> <span class="toc-text">1. 攻击者从 Pancake 的 WBNB&#x2F;BUSD 交易对中借出大量 WBNB；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%B0%86%E7%AC%AC-1-%E6%AD%A5%E5%80%9F%E5%87%BA%E7%9A%84%E5%85%A8%E9%83%A8-WBNB-%E4%B8%AD%E7%9A%84%E4%B8%80%E5%8D%8A%E9%80%9A%E8%BF%87-Panther-%E7%9A%84-SHARK-WBNB-%E4%BA%A4%E6%98%93%E5%AF%B9%E5%85%91%E6%8D%A2%E5%87%BA%E5%A4%A7%E9%87%8F%E7%9A%84-SHARK%EF%BC%8C%E5%90%8C%E6%97%B6%E6%B1%A0%E4%B8%AD-WBNB-%E7%9A%84%E6%95%B0%E9%87%8F%E5%A2%9E%E5%A4%9A%EF%BC%9B"><span class="toc-number">3.3.</span> <span class="toc-text">2. 将第 1 步借出的全部 WBNB 中的一半通过 Panther 的 SHARK&#x2F;WBNB 交易对兑换出大量的 SHARK，同时池中 WBNB 的数量增多；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%B0%86%E7%AC%AC-1-%E6%AD%A5%E5%92%8C%E7%AC%AC-2-%E6%AD%A5%E7%9A%84-WBNB-%E5%92%8C-SHARK-%E6%89%93%E5%85%A5%E5%88%B0-SharkMinter-%E4%B8%AD%EF%BC%8C%E4%B8%BA%E5%90%8E%E7%BB%AD%E6%94%BB%E5%87%BB%E5%81%9A%E5%87%86%E5%A4%87%EF%BC%9B"><span class="toc-number">3.4.</span> <span class="toc-text">3. 将第 1 步和第 2 步的 WBNB 和 SHARK 打入到 SharkMinter 中，为后续攻击做准备；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%B0%83%E7%94%A8-AutoShark-%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84-WBNB-SHARK-%E7%AD%96%E7%95%A5%E6%B1%A0%E4%B8%AD%E7%9A%84-getReward-%E5%87%BD%E6%95%B0%EF%BC%8C%E8%AF%A5%E5%87%BD%E6%95%B0%E4%BC%9A%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E8%8E%B7%E5%88%A9%E7%9A%84%E8%B5%84%E9%87%91%E4%BB%8E%E4%B8%AD%E6%8A%BD%E5%87%BA%E4%B8%80%E9%83%A8%E5%88%86%E6%89%8B%E7%BB%AD%E8%B4%B9%EF%BC%8C%E4%BD%9C%E4%B8%BA%E8%B4%A1%E7%8C%AE%E5%80%BC%E7%BB%99%E7%94%A8%E6%88%B7%E5%A5%96%E5%8A%B1-SHARK-%E4%BB%A3%E5%B8%81%EF%BC%8C%E8%BF%99%E9%83%A8%E5%88%86%E6%93%8D%E4%BD%9C%E5%9C%A8-SharkMinter-%E5%90%88%E7%BA%A6%E4%B8%AD%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%EF%BC%9B"><span class="toc-number">3.5.</span> <span class="toc-text">4. 调用 AutoShark 项目中的 WBNB&#x2F;SHARK 策略池中的 getReward 函数，该函数会根据用户获利的资金从中抽出一部分手续费，作为贡献值给用户奖励 SHARK 代币，这部分操作在 SharkMinter 合约中进行操作；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-SharkMinter-%E5%90%88%E7%BA%A6%E5%9C%A8%E6%94%B6%E5%88%B0%E7%94%A8%E6%88%B7%E6%94%B6%E7%9B%8A%E7%9A%84-LP-%E6%89%8B%E7%BB%AD%E8%B4%B9%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BC%9A%E5%B0%86-LP-%E9%87%8D%E6%96%B0%E6%8B%86%E6%88%90%E5%AF%B9%E5%BA%94%E7%9A%84-WBNB-%E5%92%8C-SHARK%EF%BC%8C%E9%87%8D%E6%96%B0%E5%8A%A0%E5%85%A5%E5%88%B0-Panther-%E7%9A%84-WBNB-SHARK-%E4%BA%A4%E6%98%93%E6%B1%A0%E4%B8%AD%EF%BC%9B"><span class="toc-number">3.6.</span> <span class="toc-text">5. SharkMinter 合约在收到用户收益的 LP 手续费之后，会将 LP 重新拆成对应的 WBNB 和 SHARK，重新加入到 Panther 的 WBNB&#x2F;SHARK 交易池中；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E7%94%B1%E4%BA%8E%E7%AC%AC-3-%E6%AD%A5%E6%94%BB%E5%87%BB%E8%80%85%E5%B7%B2%E7%BB%8F%E4%BA%8B%E5%85%88%E5%B0%86%E5%AF%B9%E5%BA%94%E7%9A%84%E4%BB%A3%E5%B8%81%E6%89%93%E5%85%A5%E5%88%B0-SharkMinter-%E5%90%88%E7%BA%A6%E4%B8%AD%EF%BC%8CSharkMinter-%E5%90%88%E7%BA%A6%E5%9C%A8%E7%A7%BB%E9%99%A4%E6%B5%81%E5%8A%A8%E6%80%A7%E5%90%8E%E5%86%8D%E6%B7%BB%E5%8A%A0%E6%B5%81%E5%8A%A8%E6%80%A7%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AF-SharkMinter-%E5%90%88%E7%BA%A6%E6%9C%AC%E8%BA%AB%E7%9A%84-WBNB-%E5%92%8C-SHARK-%E4%BD%99%E9%A2%9D%E8%BF%9B%E8%A1%8C%E6%B7%BB%E5%8A%A0%EF%BC%8C%E8%BF%99%E9%83%A8%E5%88%86%E4%BD%99%E9%A2%9D%E5%8C%85%E5%90%AB%E6%94%BB%E5%87%BB%E8%80%85%E5%9C%A8%E7%AC%AC-3-%E6%AD%A5%E6%89%93%E5%85%A5-SharkMinter-%E7%9A%84%E4%BD%99%E9%A2%9D%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%9C%80%E5%90%8E%E5%90%88%E7%BA%A6%E8%8E%B7%E5%8F%96%E7%9A%84%E6%B7%BB%E5%8A%A0%E6%B5%81%E5%8A%A8%E6%80%A7%E7%9A%84%E4%BD%99%E9%A2%9D%E6%98%AF%E9%94%99%E8%AF%AF%E7%9A%84%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4-SharkMinter-%E5%90%88%E7%BA%A6%E8%AF%AF%E4%BB%A5%E4%B8%BA%E6%94%BB%E5%87%BB%E8%80%85%E6%89%93%E5%85%A5%E4%BA%86%E5%B7%A8%E9%87%8F%E7%9A%84%E6%89%8B%E7%BB%AD%E8%B4%B9%E5%88%B0%E5%90%88%E7%BA%A6%E4%B8%AD%EF%BC%9B"><span class="toc-number">3.7.</span> <span class="toc-text">6. 由于第 3 步攻击者已经事先将对应的代币打入到 SharkMinter 合约中，SharkMinter 合约在移除流动性后再添加流动性的时候，使用的是 SharkMinter 合约本身的 WBNB 和 SHARK 余额进行添加，这部分余额包含攻击者在第 3 步打入 SharkMinter 的余额，导致最后合约获取的添加流动性的余额是错误的，也就是说 SharkMinter 合约误以为攻击者打入了巨量的手续费到合约中；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-SharkMinter-%E5%90%88%E7%BA%A6%E5%9C%A8%E8%8E%B7%E5%8F%96%E5%88%B0%E6%89%8B%E7%BB%AD%E8%B4%B9%E7%9A%84%E6%95%B0%E9%87%8F%E5%90%8E%EF%BC%8C%E4%BC%9A%E9%80%9A%E8%BF%87-tvlInWBNB-%E5%87%BD%E6%95%B0%E8%AE%A1%E7%AE%97%E8%BF%99%E9%83%A8%E5%88%86%E6%89%8B%E7%BB%AD%E8%B4%B9%E7%9A%84%E4%BB%B7%E5%80%BC%EF%BC%8C%E7%84%B6%E5%90%8E%E6%A0%B9%E6%8D%AE%E6%89%8B%E7%BB%AD%E8%B4%B9%E7%9A%84%E4%BB%B7%E5%80%BC%E9%93%B8%E5%B8%81-SHARK-%E4%BB%A3%E5%B8%81%E7%BB%99%E7%94%A8%E6%88%B7%E3%80%82%E4%BD%86%E6%98%AF%E5%9C%A8%E8%AE%A1%E7%AE%97-LP-%E4%BB%B7%E5%80%BC%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AF-Panther-WBNB-SHARK-%E6%B1%A0%E7%9A%84-WBNB-%E5%AE%9E%E6%97%B6%E6%95%B0%E9%87%8F%E9%99%A4%E4%BB%A5-LP-%E6%80%BB%E9%87%8F%E6%9D%A5%E8%AE%A1%E7%AE%97-LP-%E8%83%BD%E5%85%91%E6%8D%A2%E5%A4%9A%E5%B0%91-WBNB%E3%80%82%E4%BD%86%E6%98%AF%E7%94%B1%E4%BA%8E%E5%9C%A8%E7%AC%AC-2-%E6%AD%A5%E4%B8%AD%EF%BC%8CPanther-%E6%B1%A0%E4%B8%AD-WBNB-%E7%9A%84%E6%95%B0%E9%87%8F%E5%B7%B2%E7%BB%8F%E9%9D%9E%E5%B8%B8%E5%A4%9A%EF%BC%8C%E5%AF%BC%E8%87%B4%E8%AE%A1%E7%AE%97%E5%87%BA%E6%9D%A5%E7%9A%84-LP-%E7%9A%84%E4%BB%B7%E5%80%BC%E9%9D%9E%E5%B8%B8%E9%AB%98%EF%BC%9B"><span class="toc-number">3.8.</span> <span class="toc-text">7. SharkMinter 合约在获取到手续费的数量后，会通过 tvlInWBNB 函数计算这部分手续费的价值，然后根据手续费的价值铸币 SHARK 代币给用户。但是在计算 LP 价值的时候，使用的是 Panther WBNB&#x2F;SHARK 池的 WBNB 实时数量除以 LP 总量来计算 LP 能兑换多少 WBNB。但是由于在第 2 步中，Panther 池中 WBNB 的数量已经非常多，导致计算出来的 LP 的价值非常高；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E5%9C%A8-LP-%E4%BB%B7%E5%80%BC%E9%94%99%E8%AF%AF%E5%92%8C%E6%89%8B%E7%BB%AD%E8%B4%B9%E8%8E%B7%E5%8F%96%E6%95%B0%E9%87%8F%E9%94%99%E8%AF%AF%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8CSharkMinter-%E5%90%88%E7%BA%A6%E6%9C%80%E5%90%8E%E5%9C%A8%E8%AE%A1%E7%AE%97%E6%94%BB%E5%87%BB%E8%80%85%E7%9A%84%E8%B4%A1%E7%8C%AE%E7%9A%84%E6%97%B6%E5%80%99%E8%AE%A1%E7%AE%97%E5%87%BA%E4%BA%86%E4%B8%80%E4%B8%AA%E9%9D%9E%E5%B8%B8%E5%A4%A7%E7%9A%84%E5%80%BC%EF%BC%8C%E5%AF%BC%E8%87%B4-SharkMinter-%E5%90%88%E7%BA%A6%E7%BB%99%E6%94%BB%E5%87%BB%E8%80%85%E9%93%B8%E5%87%BA%E4%BA%86%E5%A4%A7%E9%87%8F%E7%9A%84-SHARK-%E4%BB%A3%E5%B8%81%EF%BC%9B"><span class="toc-number">3.9.</span> <span class="toc-text">8. 在 LP 价值错误和手续费获取数量错误的情况下，SharkMinter 合约最后在计算攻击者的贡献的时候计算出了一个非常大的值，导致 SharkMinter 合约给攻击者铸出了大量的 SHARK 代币；</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E6%94%BB%E5%87%BB%E8%80%85%E5%90%8E%E7%BB%AD%E9%80%9A%E8%BF%87%E5%8D%96%E5%87%BA-SHARK-%E4%BB%A3%E5%B8%81%E6%9D%A5%E6%8D%A2%E5%87%BA-WBNB%EF%BC%8C%E5%81%BF%E8%BF%98%E9%97%AA%E7%94%B5%E8%B4%B7%E3%80%82%E7%84%B6%E5%90%8E%E8%8E%B7%E5%88%A9%E7%A6%BB%E5%BC%80%E3%80%82"><span class="toc-number">3.10.</span> <span class="toc-text">9. 攻击者后续通过卖出 SHARK 代币来换出 WBNB，偿还闪电贷。然后获利离开。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%BB%93%E6%9E%9C"><span class="toc-number">4.</span> <span class="toc-text">事件处理结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AutoShark%E5%AE%98%E6%96%B9%E7%BB%99%E7%9A%84%E8%A1%A5%E5%81%BF%E8%AE%A1%E5%88%92%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">AutoShark官方给的补偿计划：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PantherSwap%E5%85%B3%E5%81%9C%E6%89%80%E6%9C%89-SHARK%E7%9A%84LP%E6%B1%A0"><span class="toc-number">4.2.</span> <span class="toc-text">PantherSwap关停所有$SHARK的LP池</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&text=AutoShark Finance被套利分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&title=AutoShark Finance被套利分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&is_video=false&description=AutoShark Finance被套利分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=AutoShark Finance被套利分析&body=Check out this article: https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&title=AutoShark Finance被套利分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&title=AutoShark Finance被套利分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&title=AutoShark Finance被套利分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&title=AutoShark Finance被套利分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&name=AutoShark Finance被套利分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/Exploit&amp;Attack/AutoShark-Finance%E8%A2%AB%E5%A5%97%E5%88%A9%E5%88%86%E6%9E%90/&t=AutoShark Finance被套利分析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2024
    guozhe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/guozhe001">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
