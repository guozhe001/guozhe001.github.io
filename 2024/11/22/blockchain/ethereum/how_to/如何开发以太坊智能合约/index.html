<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="一些开发合约相关资料  合约开发语言：soliditylang；中文版 开发工具：remix-project 开发网络：ganache，hardhat，scaffold-eth:以太坊开发all in one solc版本列表  环境搭建（MAC） 安装solidity 1brew install solidity 安装truffle truffle是集成安装、部署、测试合约为一体的开发框架；如果">
<meta property="og:type" content="article">
<meta property="og:title" content="使用solidity开发以太坊智能合约">
<meta property="og:url" content="https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/index.html">
<meta property="og:site_name" content="滴水成涓">
<meta property="og:description" content="一些开发合约相关资料  合约开发语言：soliditylang；中文版 开发工具：remix-project 开发网络：ganache，hardhat，scaffold-eth:以太坊开发all in one solc版本列表  环境搭建（MAC） 安装solidity 1brew install solidity 安装truffle truffle是集成安装、部署、测试合约为一体的开发框架；如果">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210309173249673.png">
<meta property="article:published_time" content="2024-11-22T06:32:06.492Z">
<meta property="article:modified_time" content="2024-11-22T06:32:06.492Z">
<meta property="article:author" content="guozhe">
<meta property="article:tag" content="blockchain">
<meta property="article:tag" content="ethereum">
<meta property="article:tag" content="solidity">
<meta property="article:tag" content="智能合约">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210309173249673.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>使用solidity开发以太坊智能合约</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="滴水成涓" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/guozhe001">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2024/11/22/blockchain/ethereum/how_to/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%E6%9C%80%E4%BD%B3%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E5%8F%8D%E6%A8%A1%E5%BC%8F/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E8%B0%83%E7%94%A8erc20%E5%90%88%E7%BA%A6%E7%9A%84%E8%BD%AC%E8%B4%A6%E6%96%B9%E6%B3%95/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&text=使用solidity开发以太坊智能合约"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&title=使用solidity开发以太坊智能合约"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&is_video=false&description=使用solidity开发以太坊智能合约"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=使用solidity开发以太坊智能合约&body=Check out this article: https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&title=使用solidity开发以太坊智能合约"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&title=使用solidity开发以太坊智能合约"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&title=使用solidity开发以太坊智能合约"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&title=使用solidity开发以太坊智能合约"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&name=使用solidity开发以太坊智能合约&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&t=使用solidity开发以太坊智能合约"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%BC%80%E5%8F%91%E5%90%88%E7%BA%A6%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99"><span class="toc-number">1.</span> <span class="toc-text">一些开发合约相关资料</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%88MAC%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">环境搭建（MAC）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85solidity"><span class="toc-number">1.1.1.</span> <span class="toc-text">安装solidity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85truffle"><span class="toc-number">1.1.2.</span> <span class="toc-text">安装truffle</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91"><span class="toc-number">1.2.</span> <span class="toc-text">合约开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">初始化项目路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96npm%E7%8E%AF%E5%A2%83"><span class="toc-number">1.2.2.</span> <span class="toc-text">初始化npm环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85npm%E4%BE%9D%E8%B5%96%E5%BA%93"><span class="toc-number">1.2.3.</span> <span class="toc-text">安装npm依赖库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C"><span class="toc-number">1.2.4.</span> <span class="toc-text">配置网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%90%88%E7%BA%A6"><span class="toc-number">1.2.5.</span> <span class="toc-text">开发合约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%90%88%E7%BA%A6"><span class="toc-number">1.2.6.</span> <span class="toc-text">编译合约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%90%88%E7%BA%A6"><span class="toc-number">1.2.7.</span> <span class="toc-text">部署合约</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8truffle%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%88%B0ropsten%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C"><span class="toc-number">1.3.</span> <span class="toc-text">使用truffle部署智能合约到ropsten测试网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="toc-number">1.3.1.</span> <span class="toc-text">解决方案：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%EF%BC%9A"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">添加依赖：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8%E4%B8%8Etruffle-config-js%E7%9B%B8%E5%90%8C%E7%9A%84%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%B7%BB%E5%8A%A0-evn%E6%96%87%E4%BB%B6%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%99%E5%85%A5%E4%BD%A0%E7%9A%84%E5%8A%A9%E8%AE%B0%E8%AF%8D%EF%BC%8C%E5%A6%82%EF%BC%9A"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">在与truffle-config.js相同的目录下添加.evn文件，然后写入你的助记词，如：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9truffle-config-js%EF%BC%9A%E5%9C%A8%E6%9C%80%E4%B8%8A%E9%9D%A2%E6%B7%BB%E5%8A%A0%EF%BC%9A"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">修改truffle-config.js：在最上面添加：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9ropsten%E7%9A%84%E9%85%8D%E7%BD%AE%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">修改ropsten的配置如下：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E9%83%A8%E7%BD%B2%EF%BC%9A"><span class="toc-number">1.3.2.</span> <span class="toc-text">重新部署：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E5%90%88%E7%BA%A6%E4%BA%A4%E4%BA%92"><span class="toc-number">1.4.</span> <span class="toc-text">与合约交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8remix%E4%B8%AD%E8%B0%83%E7%94%A8%E5%90%88%E7%BA%A6"><span class="toc-number">1.4.1.</span> <span class="toc-text">在remix中调用合约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8truffle%E7%9A%84%E5%91%BD%E4%BB%A4%E8%B0%83%E7%94%A8%E5%90%88%E7%BA%A6"><span class="toc-number">1.4.2.</span> <span class="toc-text">使用truffle的命令调用合约</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8truffle%E7%9A%84console%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%9A"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">启动truffle的console控制台：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E4%B9%8B%E5%90%8E%E5%8F%8C%E5%87%BB%E4%B8%A4%E6%AC%A1tab%E9%94%AE%E4%BC%9A%E6%9C%89%E5%91%BD%E4%BB%A4%E6%8F%90%E7%A4%BA%EF%BC%8C%E6%88%91%E4%BB%AC%E6%9F%A5%E7%9C%8B%E4%B8%80%E4%B8%8B%E9%83%A8%E7%BD%B2%E7%9A%84Faucet%E5%90%88%E7%BA%A6%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">打开之后双击两次tab键会有命令提示，我们查看一下部署的Faucet合约的地址：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%88%91%E4%BB%AC%E5%90%88%E7%BA%A6%E7%9A%84%E8%B4%A6%E6%88%B7%E4%BD%99%E9%A2%9D%EF%BC%9A"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">查看我们合约的账户余额：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#truffle-develop"><span class="toc-number">1.4.3.</span> <span class="toc-text">truffle develop</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8EGas%E8%B4%B9%E7%9B%B8%E5%85%B3%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.5.</span> <span class="toc-text">与Gas费相关的注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8A%8A%E5%90%88%E7%BA%A6%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%9A%84gas%E8%B4%B9%E6%B6%88%E8%80%97%E6%9C%80%E5%B0%8F%E5%8C%96"><span class="toc-number">1.5.1.</span> <span class="toc-text">如何把合约函数调用的gas费消耗最小化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E5%8A%A8%E6%80%81%E5%B0%BA%E5%AF%B8%E7%9A%84%E6%95%B0%E7%BB%84"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">避免动态尺寸的数组</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96%E5%90%88%E7%BA%A6"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">避免调用其他合约</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%B0%E8%AE%A1gas%E5%BC%80%E9%94%80"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">估计gas开销</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        使用solidity开发以太坊智能合约
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">guozhe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-11-22T06:32:06.492Z" itemprop="datePublished">2024-11-22</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">blockchain</a> › <a class="category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/">ethereum</a> › <a class="category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/HOW-TO/">HOW-TO</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">blockchain</a>, <a class="tag-link-link" href="/tags/ethereum/" rel="tag">ethereum</a>, <a class="tag-link-link" href="/tags/solidity/" rel="tag">solidity</a>, <a class="tag-link-link" href="/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" rel="tag">智能合约</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="一些开发合约相关资料">一些开发合约相关资料</h2>
<ul>
<li>合约开发语言：<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/v0.7.0/">soliditylang</a>；<a target="_blank" rel="noopener" href="https://learnblockchain.cn/docs/solidity/">中文版</a></li>
<li>开发工具：<a target="_blank" rel="noopener" href="https://github.com/ethereum/remix-project">remix-project</a></li>
<li>开发网络：<a target="_blank" rel="noopener" href="https://www.trufflesuite.com/ganache">ganache</a>，<a target="_blank" rel="noopener" href="https://hardhat.org/">hardhat</a>，<a target="_blank" rel="noopener" href="https://github.com/austintgriffith/scaffold-eth">scaffold-eth:以太坊开发all in one</a></li>
<li><a target="_blank" rel="noopener" href="http://solc-bin.ethereum.org/bin/list.json">solc版本列表</a></li>
</ul>
<h3 id="环境搭建（MAC）">环境搭建（MAC）</h3>
<h4 id="安装solidity">安装solidity</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install solidity</span><br></pre></td></tr></table></figure>
<h4 id="安装truffle">安装truffle</h4>
<p>truffle是集成安装、部署、测试合约为一体的开发框架；如果没有node环境需要先安装node:<code>brew install node</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install truffle -g</span><br></pre></td></tr></table></figure>
<h3 id="合约开发">合约开发</h3>
<h4 id="初始化项目路径">初始化项目路径</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle init</span><br></pre></td></tr></table></figure>
<h4 id="初始化npm环境">初始化npm环境</h4>
<p>在初始化的过程中会让你输入一些参数的值，可以一路按回车全部使用默认值即可</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>
<h4 id="安装npm依赖库">安装npm依赖库</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install dotenv truffle-wallet-provider ethereumjs-wallet</span><br></pre></td></tr></table></figure>
<h4 id="配置网络">配置网络</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  networks: &#123;</span><br><span class="line">    localnode: &#123;</span><br><span class="line">      network_id: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">      host: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">      port: <span class="string">&quot;8545&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mocha: &#123;</span><br><span class="line">    <span class="comment">// timeout: 100000</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  compilers: &#123;</span><br><span class="line">    solc: &#123;</span><br><span class="line">      version: <span class="string">&quot;0.8.0+commit.c7dfd78e&quot;</span>,    <span class="comment">// Fetch exact version from solc-bin (default: truffle&#x27;s version)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  db: &#123;</span><br><span class="line">    enabled: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="开发合约">开发合约</h4>
<p>按照《精通以太坊》书本的例子写了一个“水龙头”的合约，只有两个函数，一个提取以太币（withdraw），一个接收以太币（receive）。合约的代码放在项目的<code>contracts</code>目录下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity &gt;&#x3D;0.7.0 &lt;0.8.0;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; my first contract</span><br><span class="line">contract Faucet &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Give out ether to anyone who asks</span><br><span class="line">    function withdraw(uint withdraw_amount) public &#123;</span><br><span class="line">        &#x2F;&#x2F; limit withdrawal amount</span><br><span class="line">        require(withdraw_amount &lt;&#x3D; 1 * 1000 * 1000 * 1000 * 1000);</span><br><span class="line"></span><br><span class="line">        msg.sender.transfer(withdraw_amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Accept any incoming amount 一个默认的函数</span><br><span class="line">    &#x2F;&#x2F; fallback () external payable &#123;&#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 推荐使用receive()函数来接收以太币</span><br><span class="line">    receive() external payable&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="编译合约">编译合约</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle compile</span><br></pre></td></tr></table></figure>
<h4 id="部署合约">部署合约</h4>
<p>参考<code>migrations/1_initial_migration.js</code>文件，新建一个``migrations/2_initial_migration.js<code>；(*注意：2_initial_migration.js这个名字不能以</code>0`开头，否则部署的时候会忽略。。。*)修改文件内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Faucet = artifacts.require(<span class="string">&quot;Faucet&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">deployer</span>) </span>&#123;</span><br><span class="line">  deployer.deploy(Faucet);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后部署到本地的测试网络（要在本地启动truffle的ethereum测试网络）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle migrate --network localnode</span><br></pre></td></tr></table></figure>
<p>执行完成之后的日志如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">(base) w:Faucet apple$ truffle migrate --network localnode</span><br><span class="line"></span><br><span class="line">Compiling your contracts...</span><br><span class="line">===========================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/Faucet.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiled successfully using:</span></span><br><span class="line">   - solc: 0.8.0+commit.c7dfd78e.Emscripten.clang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting migrations...</span><br><span class="line">======================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network name:    <span class="string">&#x27;localnode&#x27;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network id:      1337</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Block gas <span class="built_in">limit</span>: 6721975 (0x6691b7)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Replacing &#x27;Migrations&#x27;</span><br><span class="line">   ----------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> transaction <span class="built_in">hash</span>:    0xaf813946c7470d83c7fb1e8b535efebcfdd90540c72ee9092ae9e04775bf56bc</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Blocks: 0            Seconds: 0</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> contract address:    0x4445151f84Fd5E71aB93f0d9A1AC93fd7a454c10</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block number:        1</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block timestamp:     1615445677</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> account:             0xc0F680767D4Ae17C7adaF8C6d0b4805Bc207805e</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> balance:             99.99511424</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas used:            244288 (0x3ba40)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas price:           20 gwei</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> value sent:          0 ETH</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> total cost:          0.00488576 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving migration to chain.</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving artifacts</span></span><br><span class="line">   -------------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Total cost:          0.00488576 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Replacing &#x27;Faucet&#x27;</span><br><span class="line">   ------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> transaction <span class="built_in">hash</span>:    0xcb451bc9f9347fa9983e5182ccc4453f1a3c7ac74b5c7785679913a7325f7715</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Blocks: 0            Seconds: 0</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> contract address:    0x6B7d6480BC95EF2C51d2Ae247bDd2aC3bBA5690c</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block number:        3</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block timestamp:     1615445677</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> account:             0xc0F680767D4Ae17C7adaF8C6d0b4805Bc207805e</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> balance:             99.9888339</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas used:            271504 (0x42490)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas price:           20 gwei</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> value sent:          0 ETH</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> total cost:          0.00543008 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving migration to chain.</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving artifacts</span></span><br><span class="line">   -------------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Total cost:          0.00543008 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Summary</span><br><span class="line">=======</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Total deployments:   2</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Final cost:          0.01031584 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="使用truffle部署智能合约到ropsten测试网络">使用truffle部署智能合约到ropsten测试网络</h3>
<p>可以在https://infura.io/网站建立账号，可以把它看成一个geth节点，然后他提供了rpc接口。</p>
<p>首次执行部署，报错说HDWalletProvider没有定义</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> truffle migrate --network ropsten</span></span><br><span class="line"></span><br><span class="line">Compiling your contracts...</span><br><span class="line">===========================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/GZToken.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/Token2.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/Token3.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiled successfully using:</span></span><br><span class="line">   - solc: 0.8.0+commit.c7dfd78e.Emscripten.clang</span><br><span class="line"></span><br><span class="line">ReferenceError: HDWalletProvider is not defined</span><br><span class="line">    at Object.provider (/Users/apple/code/open-source/my-projects/etherum/Faucet/truffle-config.js:62:21)</span><br><span class="line">    at Object.getProvider (/usr/local/lib/node_modules/truffle/build/webpack:/packages/provider/index.js:20:1)</span><br><span class="line">    at Object.create (/usr/local/lib/node_modules/truffle/build/webpack:/packages/provider/index.js:13:1)</span><br><span class="line">    at TruffleConfig.get [as provider] (/usr/local/lib/node_modules/truffle/build/webpack:/packages/config/dist/configDefaults.js:204:1)</span><br><span class="line">    at Object.detect (/usr/local/lib/node_modules/truffle/build/webpack:/packages/environment/environment.js:19:1)</span><br><span class="line">    at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate.js:206:1)</span><br><span class="line">    at Command.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/command.js:136:1)</span><br><span class="line">Truffle v5.2.3 (core: 5.2.3)</span><br><span class="line">Node v14.16.0</span><br></pre></td></tr></table></figure>
<h4 id="解决方案：">解决方案：</h4>
<h5 id="添加依赖：">添加依赖：</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install truffle-hdwallet-provider</span><br><span class="line">npm install dotenv</span><br></pre></td></tr></table></figure>
<h5 id="在与truffle-config-js相同的目录下添加-evn文件，然后写入你的助记词，如：">在与truffle-config.js相同的目录下添加<code>.evn</code>文件，然后写入你的助记词，如：</h5>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mnemonic&#x3D;topic foster find apple famous have bonus month remain middle funny smart</span><br></pre></td></tr></table></figure>
<p><em>注意在gitignore文件中把这个文件（<code>.evn</code>）忽略，避免上传到github</em></p>
<h5 id="修改truffle-config-js：在最上面添加：">修改truffle-config.js：在最上面添加：</h5>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在使用infura作为rpc-api的提供方时，因为infura不管理我们的私钥所以要在本地有一个钱包用于签名</span></span><br><span class="line"><span class="keyword">var</span> HDWalletProvider = <span class="built_in">require</span>(<span class="string">&quot;truffle-hdwallet-provider&quot;</span>);</span><br><span class="line"><span class="comment">// 默认读取项目根目录下的.env文件,用process.env.调用</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).config();</span><br><span class="line"><span class="keyword">if</span> (result.error) &#123;</span><br><span class="line">  <span class="keyword">throw</span> result.error;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="修改ropsten的配置如下：">修改ropsten的配置如下：</h5>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ropsten: &#123;</span><br><span class="line">      provider: <span class="function">() =&gt;</span> <span class="keyword">new</span> HDWalletProvider(process.env.mnemonic, <span class="string">`https://ropsten.infura.io/v3/your-id`</span>),</span><br><span class="line">      network_id: <span class="number">3</span>,       <span class="comment">// Ropsten&#x27;s id</span></span><br><span class="line">      gas: <span class="number">5500000</span>,        <span class="comment">// Ropsten has a lower block limit than mainnet</span></span><br><span class="line">      confirmations: <span class="number">2</span>,    <span class="comment">// # of confs to wait between deployments. (default: 0)</span></span><br><span class="line">      timeoutBlocks: <span class="number">200</span>,  <span class="comment">// # of blocks before a deployment times out  (minimum/default: 50)</span></span><br><span class="line">      skipDryRun: <span class="literal">true</span>     <span class="comment">// Skip dry run before migrations? (default: false for public nets )</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h4 id="重新部署：">重新部署：</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">truffle migrate --network ropsten</span></span><br><span class="line"></span><br><span class="line">Compiling your contracts...</span><br><span class="line">===========================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/GZToken.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/Token3.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiled successfully using:</span></span><br><span class="line">   - solc: 0.8.0+commit.c7dfd78e.Emscripten.clang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting migrations...</span><br><span class="line">======================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network name:    <span class="string">&#x27;ropsten&#x27;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network id:      3</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Block gas <span class="built_in">limit</span>: 8000000 (0x7a1200)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;Migrations&#x27;</span><br><span class="line">   ----------------------</span><br><span class="line"></span><br><span class="line">Error:  *** Deployment Failed ***</span><br><span class="line"></span><br><span class="line">&quot;Migrations&quot; -- insufficient funds for gas * price + value.</span><br><span class="line"></span><br><span class="line">    at /usr/local/lib/node_modules/truffle/build/webpack:/packages/deployer/src/deployment.js:365:1</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:93:5)</span><br><span class="line">    at Migration._deploy (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:74:1)</span><br><span class="line">    at Migration._load (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:61:1)</span><br><span class="line">    at Migration.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:212:1)</span><br><span class="line">    at Object.runMigrations (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:150:1)</span><br><span class="line">    at Object.runFrom (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:110:1)</span><br><span class="line">    at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:87:1)</span><br><span class="line">    at runMigrations (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate.js:263:1)</span><br><span class="line">    at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate.js:228:1)</span><br><span class="line">    at Command.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/command.js:136:1)</span><br><span class="line">Truffle v5.2.3 (core: 5.2.3)</span><br><span class="line">Node v14.16.0</span><br></pre></td></tr></table></figure>
<p>原因是没有足够的汽油费，去https://faucet.ropsten.be/获取即可。</p>
<p>在此重新部署：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> truffle migrate --network ropsten</span></span><br><span class="line"></span><br><span class="line">Compiling your contracts...</span><br><span class="line">===========================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/Token3.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiled successfully using:</span></span><br><span class="line">   - solc: 0.8.0+commit.c7dfd78e.Emscripten.clang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting migrations...</span><br><span class="line">======================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network name:    <span class="string">&#x27;ropsten&#x27;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network id:      3</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Block gas <span class="built_in">limit</span>: 8000000 (0x7a1200)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;Migrations&#x27;</span><br><span class="line">   ----------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> transaction <span class="built_in">hash</span>:    0x212e4eee81d5fc3024db8d6787b36a51f070f832b94961605de18675d8f597d3</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Blocks: 2            Seconds: 13</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> contract address:    0x0d4f7ff83b66e1E3377aacE5EFA70d9E036890c2</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block number:        9941219</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block timestamp:     1617088554</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> account:             0x2560be5793F9AA00963e163A1287807Feb897e2F</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> balance:             0.99508824</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas used:            245588 (0x3bf54)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas price:           20 gwei</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> value sent:          0 ETH</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> total cost:          0.00491176 ETH</span></span><br><span class="line"></span><br><span class="line">   Pausing for 2 confirmations...</span><br><span class="line">   ------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> confirmation number: 2 (block: 9941221)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving migration to chain.</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving artifacts</span></span><br><span class="line">   -------------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Total cost:          0.00491176 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;Faucet&#x27;</span><br><span class="line">   ------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> transaction <span class="built_in">hash</span>:    0x40ead4c9b0fa1efb90d551e43587c10457e0c99deeaf4f804222645395435090</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Blocks: 2            Seconds: 21</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> contract address:    0xE18C40cEf01bEedA140033892b4638CFBc464BbD</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block number:        9941227</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block timestamp:     1617088603</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> account:             0x2560be5793F9AA00963e163A1287807Feb897e2F</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> balance:             0.9887139</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas used:            272804 (0x429a4)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas price:           20 gwei</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> value sent:          0 ETH</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> total cost:          0.00545608 ETH</span></span><br><span class="line"></span><br><span class="line">   Pausing for 2 confirmations...</span><br><span class="line">   ------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> confirmation number: 1 (block: 9941229)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> confirmation number: 2 (block: 9941230)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving migration to chain.</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving artifacts</span></span><br><span class="line">   -------------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Total cost:          0.00545608 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;GZToken&#x27;</span><br><span class="line">   -------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> transaction <span class="built_in">hash</span>:    0xf28b9b32e6cbf0b12a44249dd4c6eb914706820daafc671e43cabb4541d5396b</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Blocks: 2            Seconds: 25</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> contract address:    0xB8DfEe0D9aC703E75EE3D031148227B3BbB26524</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block number:        9941234</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block timestamp:     1617088662</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> account:             0x2560be5793F9AA00963e163A1287807Feb897e2F</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> balance:             0.9713052</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas used:            841622 (0xcd796)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas price:           20 gwei</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> value sent:          0 ETH</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> total cost:          0.01683244 ETH</span></span><br><span class="line"></span><br><span class="line">   Pausing for 2 confirmations...</span><br><span class="line">   ------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> confirmation number: 1 (block: 9941235)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> confirmation number: 2 (block: 9941236)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving migration to chain.</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving artifacts</span></span><br><span class="line">   -------------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Total cost:          0.01683244 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Summary</span><br><span class="line">=======</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Total deployments:   3</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Final cost:          0.02720028 ETH</span></span><br></pre></td></tr></table></figure>
<p>调用合约的报错汇总：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Received unexpected error:</span><br><span class="line">        	            	out of gas</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intrinsic gas too low: have 0, want 21420 (supplied gas 0)</span><br></pre></td></tr></table></figure>
<p>上面这些全部都是因为gas费设置的太少导致的。</p>
<h3 id="与合约交互">与合约交互</h3>
<h4 id="在remix中调用合约">在<a target="_blank" rel="noopener" href="https://remix.ethereum.org/">remix</a>中调用合约</h4>
<p>在<a target="_blank" rel="noopener" href="https://remix.ethereum.org/">remix</a>网页中部署完成合约之后，在下面可以看到withdraw函数，输入提现的金额然后点击transact按钮，就可以调起MetaMask调用智能合约。</p>
<p><img src="https://cdn.jsdelivr.net/gh/guozhe001/oss/image-20210309173249673.png" alt="image-20210309173249673"></p>
<h4 id="使用truffle的命令调用合约">使用truffle的命令调用合约</h4>
<h5 id="启动truffle的console控制台：">启动truffle的console控制台：</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle console --network localnode</span><br></pre></td></tr></table></figure>
<h5 id="打开之后双击两次tab键会有命令提示，我们查看一下部署的Faucet合约的地址：">打开之后双击两次<code>tab</code>键会有命令提示，我们查看一下部署的<code>Faucet</code>合约的地址：</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">truffle(localnode)&gt;</span><span class="bash"> Faucet.address</span></span><br><span class="line">&#x27;0x6B7d6480BC95EF2C51d2Ae247bDd2aC3bBA5690c&#x27;</span><br></pre></td></tr></table></figure>
<h5 id="查看我们合约的账户余额：">查看我们合约的账户余额：</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">truffle(localnode)&gt;</span><span class="bash"> web3.eth.getBalance(Faucet.address)</span></span><br><span class="line">&#x27;0&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="truffle-develop">truffle develop</h4>
<p>develop   Open a console with a local development blockchain</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">truffle(develop)&gt;</span><span class="bash"> Faucet.deployed().<span class="keyword">then</span>(i =&gt; &#123;FaucetDeployed = i&#125;)</span></span><br><span class="line">// 发送给合约1个eth</span><br><span class="line"><span class="meta">truffle(develop)&gt;</span><span class="bash"> FaucetDeployed.send(web3.utils.toWei(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;ether&quot;</span>)).<span class="keyword">then</span>(res =&gt; &#123; console.log(res.logs[0].event, res.logs[0].args) &#125;)</span></span><br><span class="line">Deposit Result &#123;</span><br><span class="line">  &#x27;0&#x27;: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;,</span><br><span class="line">  &#x27;1&#x27;: BN &#123;</span><br><span class="line">    negative: 0,</span><br><span class="line">    words: [ 56885248, 2993385, 222, &lt;1 empty item&gt; ],</span><br><span class="line">    length: 3,</span><br><span class="line">    red: null</span><br><span class="line">  &#125;,</span><br><span class="line">  __length__: 2,</span><br><span class="line">  to: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;,</span><br><span class="line">  amount: BN &#123;</span><br><span class="line">    negative: 0,</span><br><span class="line">    words: [ 56885248, 2993385, 222, &lt;1 empty item&gt; ],</span><br><span class="line">    length: 3,</span><br><span class="line">    red: null</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 从合约提取0.1eth</span><br><span class="line"><span class="meta">truffle(develop)&gt;</span><span class="bash"> FaucetDeployed.withdraw(web3.utils.toWei(<span class="string">&quot;0.1&quot;</span>, <span class="string">&quot;ether&quot;</span>)).<span class="keyword">then</span>(res =&gt; &#123; console.log(res.logs[0].event, res.logs[0].args) &#125;)</span></span><br><span class="line">Withdrawal Result &#123;</span><br><span class="line">  &#x27;0&#x27;: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;,</span><br><span class="line">  &#x27;1&#x27;: BN &#123;</span><br><span class="line">    negative: 0,</span><br><span class="line">    words: [ 25821184, 13721111, 22, &lt;1 empty item&gt; ],</span><br><span class="line">    length: 3,</span><br><span class="line">    red: null</span><br><span class="line">  &#125;,</span><br><span class="line">  __length__: 2,</span><br><span class="line">  to: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;,</span><br><span class="line">  amount: BN &#123;</span><br><span class="line">    negative: 0,</span><br><span class="line">    words: [ 25821184, 13721111, 22, &lt;1 empty item&gt; ],</span><br><span class="line">    length: 3,</span><br><span class="line">    red: null</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="与Gas费相关的注意事项">与Gas费相关的注意事项</h3>
<p>如果在执行过程中gas费耗尽，会触发如下一系列事件：</p>
<ul>
<li>抛出“out of gas”异常</li>
<li>状态被恢复到执行开始之前</li>
<li>所有在这次执行过程中的gas开销都会被作为交易费用，以太坊不会因为交易中止而退回gas或以太币。</li>
</ul>
<h4 id="如何把合约函数调用的gas费消耗最小化">如何把合约函数调用的gas费消耗最小化</h4>
<h5 id="避免动态尺寸的数组">避免动态尺寸的数组</h5>
<p>例如对数组的每个元素进行操作，或者通过遍历的方式查找数组中的某个值。</p>
<h5 id="避免调用其他合约">避免调用其他合约</h5>
<p>调用其他合约，特别是那些gas消耗未知的合约，可能会产生高昂的gas开销。</p>
<h5 id="估计gas开销">估计gas开销</h5>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/guozhe001">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%BC%80%E5%8F%91%E5%90%88%E7%BA%A6%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99"><span class="toc-number">1.</span> <span class="toc-text">一些开发合约相关资料</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%88MAC%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">环境搭建（MAC）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85solidity"><span class="toc-number">1.1.1.</span> <span class="toc-text">安装solidity</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85truffle"><span class="toc-number">1.1.2.</span> <span class="toc-text">安装truffle</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91"><span class="toc-number">1.2.</span> <span class="toc-text">合约开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">初始化项目路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96npm%E7%8E%AF%E5%A2%83"><span class="toc-number">1.2.2.</span> <span class="toc-text">初始化npm环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85npm%E4%BE%9D%E8%B5%96%E5%BA%93"><span class="toc-number">1.2.3.</span> <span class="toc-text">安装npm依赖库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C"><span class="toc-number">1.2.4.</span> <span class="toc-text">配置网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%90%88%E7%BA%A6"><span class="toc-number">1.2.5.</span> <span class="toc-text">开发合约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%90%88%E7%BA%A6"><span class="toc-number">1.2.6.</span> <span class="toc-text">编译合约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%90%88%E7%BA%A6"><span class="toc-number">1.2.7.</span> <span class="toc-text">部署合约</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8truffle%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%88%B0ropsten%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C"><span class="toc-number">1.3.</span> <span class="toc-text">使用truffle部署智能合约到ropsten测试网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="toc-number">1.3.1.</span> <span class="toc-text">解决方案：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%EF%BC%9A"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">添加依赖：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%A8%E4%B8%8Etruffle-config-js%E7%9B%B8%E5%90%8C%E7%9A%84%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%B7%BB%E5%8A%A0-evn%E6%96%87%E4%BB%B6%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%99%E5%85%A5%E4%BD%A0%E7%9A%84%E5%8A%A9%E8%AE%B0%E8%AF%8D%EF%BC%8C%E5%A6%82%EF%BC%9A"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">在与truffle-config.js相同的目录下添加.evn文件，然后写入你的助记词，如：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9truffle-config-js%EF%BC%9A%E5%9C%A8%E6%9C%80%E4%B8%8A%E9%9D%A2%E6%B7%BB%E5%8A%A0%EF%BC%9A"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">修改truffle-config.js：在最上面添加：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9ropsten%E7%9A%84%E9%85%8D%E7%BD%AE%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">修改ropsten的配置如下：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E9%83%A8%E7%BD%B2%EF%BC%9A"><span class="toc-number">1.3.2.</span> <span class="toc-text">重新部署：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E5%90%88%E7%BA%A6%E4%BA%A4%E4%BA%92"><span class="toc-number">1.4.</span> <span class="toc-text">与合约交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8remix%E4%B8%AD%E8%B0%83%E7%94%A8%E5%90%88%E7%BA%A6"><span class="toc-number">1.4.1.</span> <span class="toc-text">在remix中调用合约</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8truffle%E7%9A%84%E5%91%BD%E4%BB%A4%E8%B0%83%E7%94%A8%E5%90%88%E7%BA%A6"><span class="toc-number">1.4.2.</span> <span class="toc-text">使用truffle的命令调用合约</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8truffle%E7%9A%84console%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%9A"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">启动truffle的console控制台：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E4%B9%8B%E5%90%8E%E5%8F%8C%E5%87%BB%E4%B8%A4%E6%AC%A1tab%E9%94%AE%E4%BC%9A%E6%9C%89%E5%91%BD%E4%BB%A4%E6%8F%90%E7%A4%BA%EF%BC%8C%E6%88%91%E4%BB%AC%E6%9F%A5%E7%9C%8B%E4%B8%80%E4%B8%8B%E9%83%A8%E7%BD%B2%E7%9A%84Faucet%E5%90%88%E7%BA%A6%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">打开之后双击两次tab键会有命令提示，我们查看一下部署的Faucet合约的地址：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%88%91%E4%BB%AC%E5%90%88%E7%BA%A6%E7%9A%84%E8%B4%A6%E6%88%B7%E4%BD%99%E9%A2%9D%EF%BC%9A"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">查看我们合约的账户余额：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#truffle-develop"><span class="toc-number">1.4.3.</span> <span class="toc-text">truffle develop</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8EGas%E8%B4%B9%E7%9B%B8%E5%85%B3%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.5.</span> <span class="toc-text">与Gas费相关的注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8A%8A%E5%90%88%E7%BA%A6%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%9A%84gas%E8%B4%B9%E6%B6%88%E8%80%97%E6%9C%80%E5%B0%8F%E5%8C%96"><span class="toc-number">1.5.1.</span> <span class="toc-text">如何把合约函数调用的gas费消耗最小化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E5%8A%A8%E6%80%81%E5%B0%BA%E5%AF%B8%E7%9A%84%E6%95%B0%E7%BB%84"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">避免动态尺寸的数组</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96%E5%90%88%E7%BA%A6"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">避免调用其他合约</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%B0%E8%AE%A1gas%E5%BC%80%E9%94%80"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">估计gas开销</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&text=使用solidity开发以太坊智能合约"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&title=使用solidity开发以太坊智能合约"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&is_video=false&description=使用solidity开发以太坊智能合约"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=使用solidity开发以太坊智能合约&body=Check out this article: https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&title=使用solidity开发以太坊智能合约"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&title=使用solidity开发以太坊智能合约"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&title=使用solidity开发以太坊智能合约"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&title=使用solidity开发以太坊智能合约"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&name=使用solidity开发以太坊智能合约&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://guozhe001.github.io/2024/11/22/blockchain/ethereum/how_to/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/&t=使用solidity开发以太坊智能合约"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2024
    guozhe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/guozhe001">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
