<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="在Fabric中交易受保护的资产 官方文档：Secured asset transfer in Fabric This tutorial will demonstrate how an asset can be represented and traded between organizations in a Hyperledger Fabric blockchain channel, while">
<meta property="og:type" content="article">
<meta property="og:title" content="在Fabric中交易受保护的资产">
<meta property="og:url" content="https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/index.html">
<meta property="og:site_name" content="滴水成涓">
<meta property="og:description" content="在Fabric中交易受保护的资产 官方文档：Secured asset transfer in Fabric This tutorial will demonstrate how an asset can be represented and traded between organizations in a Hyperledger Fabric blockchain channel, while">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/transfer_assets_1.png">
<meta property="og:image" content="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/transfer_assets_2.png">
<meta property="og:image" content="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/transfer_assets_3.png">
<meta property="og:image" content="https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/apple/Desktop/%E7%A7%81%E6%9C%89%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%98%93%E5%90%88%E7%BA%A6%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg">
<meta property="article:published_time" content="2024-11-22T06:32:06.494Z">
<meta property="article:modified_time" content="2024-11-22T06:32:06.494Z">
<meta property="article:author" content="guozhe">
<meta property="article:tag" content="blockchain">
<meta property="article:tag" content="Hyperledger-Fabric">
<meta property="article:tag" content="Secured">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/transfer_assets_1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>在Fabric中交易受保护的资产</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="滴水成涓" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/guozhe001">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2024/11/22/blockchain/fabric/how_to/%E5%B0%86%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E9%83%A8%E7%BD%B2%E5%88%B0%E9%80%9A%E9%81%93/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2024/11/22/blockchain/fabric/how_to/%E7%BC%96%E5%86%99%E6%82%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAChaincode/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&text=在Fabric中交易受保护的资产"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&title=在Fabric中交易受保护的资产"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&is_video=false&description=在Fabric中交易受保护的资产"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=在Fabric中交易受保护的资产&body=Check out this article: https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&title=在Fabric中交易受保护的资产"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&title=在Fabric中交易受保护的资产"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&title=在Fabric中交易受保护的资产"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&title=在Fabric中交易受保护的资产"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&name=在Fabric中交易受保护的资产&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&t=在Fabric中交易受保护的资产"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7"><span class="toc-number">1.</span> <span class="toc-text">在Fabric中交易受保护的资产</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Scenario-requirements%EF%BC%88%E6%96%B9%E6%A1%88%E8%A6%81%E6%B1%82%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">Scenario requirements（方案要求）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-privacy-is-maintained%EF%BC%88%E5%A6%82%E4%BD%95%E4%BF%9D%E6%8C%81%E9%9A%90%E7%A7%81%E6%80%A7%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">How privacy is maintained（如何保持隐私性）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-the-transfer-is-implemented%EF%BC%88%E4%BA%A4%E6%98%93%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E6%96%BD%E7%9A%84%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">How the transfer is implemented（交易是如何实施的）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-the-asset%EF%BC%88%E5%88%9B%E5%BB%BA%E8%B5%84%E4%BA%A7%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">Creating the asset（创建资产）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Agreeing-to-the-transfer%EF%BC%88%E5%90%8C%E6%84%8F%E4%BA%A4%E6%98%93%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">Agreeing to the transfer（同意交易）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transferring-the-asset%EF%BC%88%E4%BA%A4%E6%98%93%E8%B5%84%E4%BA%A7%EF%BC%89"><span class="toc-number">1.3.3.</span> <span class="toc-text">Transferring the asset（交易资产）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Running-the-private-asset-transfer-smart-contract%EF%BC%88%E8%BF%90%E8%A1%8C%E7%A7%81%E6%9C%89%E8%B5%84%E4%BA%A7%E8%BD%AC%E8%B4%A6%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">Running the private asset transfer smart contract（运行私有资产转账智能合约）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deploy-the-test-network%EF%BC%88%E9%83%A8%E7%BD%B2%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">Deploy the test network（部署测试网络）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deploy-the-smart-contract-%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="toc-number">1.6.</span> <span class="toc-text">Deploy the smart contract(部署智能合约)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-the-environment-variables-to-operate-as-Org2%EF%BC%88%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%BB%A5Org2%E7%9A%84%E7%AE%A1%E7%90%86%E5%91%98%E8%BA%AB%E4%BB%BD%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">1.6.1.</span> <span class="toc-text">Set the environment variables to operate as Org2（设置环境变量以Org2的管理员身份操作）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create-an-asset%EF%BC%88%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%B5%84%E4%BA%A7%EF%BC%89"><span class="toc-number">1.7.</span> <span class="toc-text">Create an asset（创建一个资产）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Operate-from-the-Org1-terminal%EF%BC%88%E9%80%9A%E8%BF%87Org1%E7%9A%84%E7%BB%88%E7%AB%AF%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">1.7.1.</span> <span class="toc-text">Operate from the Org1 terminal（通过Org1的终端操作）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Operate-from-the-Org2-terminal%EF%BC%88%E9%80%9A%E8%BF%87%E7%BB%84%E7%BB%87Org2%E7%9A%84%E7%BB%88%E7%AB%AF%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">1.7.2.</span> <span class="toc-text">Operate from the Org2 terminal（通过组织Org2的终端操作）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Agree-to-sell-the-asset-%E5%85%81%E8%AE%B8%E5%87%BA%E5%94%AE%E8%B5%84%E4%BA%A7"><span class="toc-number">1.8.</span> <span class="toc-text">Agree to sell the asset(允许出售资产)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Agree-to-sell-as-Org1%EF%BC%88%E4%BB%A5Org1%E7%9A%84%E8%BA%AB%E4%BB%BD%E5%90%8C%E6%84%8F%E5%87%BA%E5%94%AE%EF%BC%89"><span class="toc-number">1.9.</span> <span class="toc-text">Agree to sell as Org1（以Org1的身份同意出售）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Agree-to-buy-as-Org2-%E4%BB%A5Org2%E7%9A%84%E8%BA%AB%E4%BB%BD%E5%90%8C%E6%84%8F%E8%B4%AD%E4%B9%B0"><span class="toc-number">1.10.</span> <span class="toc-text">Agree to buy as Org2(以Org2的身份同意购买)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Transfer-the-asset-from-Org1-to-Org2%EF%BC%88%E6%8A%8A%E8%B5%84%E4%BA%A7%E4%BB%8EOrg1%E4%BA%A4%E6%98%93%E5%88%B0Org2%EF%BC%89"><span class="toc-number">1.11.</span> <span class="toc-text">Transfer the asset from Org1 to Org2（把资产从Org1交易到Org2）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Transfer-the-asset-as-Org1%EF%BC%88%E4%BB%A5Org1%E7%9A%84%E8%BA%AB%E4%BB%BD%E4%BA%A4%E6%98%93%E8%B5%84%E4%BA%A7%EF%BC%89"><span class="toc-number">1.11.1.</span> <span class="toc-text">Transfer the asset as Org1（以Org1的身份交易资产）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Update-the-asset-description-as-Org2%EF%BC%88%E4%BB%A5Org2%E7%9A%84%E8%BA%AB%E4%BB%BD%E6%9B%B4%E6%96%B0%E8%B5%84%E4%BA%A7%E6%8F%8F%E8%BF%B0%EF%BC%89"><span class="toc-number">1.11.2.</span> <span class="toc-text">Update the asset description as Org2（以Org2的身份更新资产描述）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clean-up"><span class="toc-number">1.12.</span> <span class="toc-text">Clean up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">1.13.</span> <span class="toc-text">流程图</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        在Fabric中交易受保护的资产
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">guozhe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-11-22T06:32:06.494Z" itemprop="datePublished">2024-11-22</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">blockchain</a> › <a class="category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/">Hyperledger-Fabric</a> › <a class="category-link" href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/HOW-TO/">HOW-TO</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/Hyperledger-Fabric/" rel="tag">Hyperledger-Fabric</a>, <a class="tag-link-link" href="/tags/Secured/" rel="tag">Secured</a>, <a class="tag-link-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">blockchain</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="在Fabric中交易受保护的资产">在Fabric中交易受保护的资产</h1>
<p>官方文档：<a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/secured_asset_transfer/secured_private_asset_transfer_tutorial.html">Secured asset transfer in Fabric</a></p>
<p>This tutorial will demonstrate how an asset can be represented and traded between organizations in a Hyperledger Fabric blockchain channel, while keeping details of the asset and transaction private using private data. Each on-chain asset is a non-fungible token (NFT) that represents a specific asset having certain immutable metadata properties (such as size and color) with a unique owner. When the owner wants to sell the asset, both parties need to agree to the same price before the asset is transferred. The private asset transfer smart contract enforces that only the owner of the asset can transfer the asset. In the course of this tutorial, you will learn how Fabric features such as state based endorsement, private data, and access control come together to provide secured transactions that are both private and verifiable.</p>
<p>本文档会演示如何在Hyperledger Fabric区块链的通道中的组织之间表示和交易资产，同时保持资产和交易的私有性。链上的每个资产都是一个NFT（non-fungible token，不可替代令牌），这个NFT代表具有唯一拥有者、具有某些不变的元数据属性（例如大小和颜色）的特定资产。当所有者想要出售资产时，双方需要在转让资产之前达成一致的价格。私有资产转让智能合约强制规定只有资产所有者才能转让资产。在本教程的过程中，您将学习如何把Fabric的特性（如基于状态的背书、私有数据和访问控制）组合在一起，以提供私有且可验证的安全交易。</p>
<p>This tutorial will deploy the <a target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric-samples/tree/master/asset-transfer-secured-agreement/chaincode-go">secured asset transfer sample</a> to demonstrate how to transfer a private asset between two organizations without publicly sharing data. You should have completed the task <a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/secured_asset_transfer/install.html#install-samples-binaries-and-docker-images">Install Samples, Binaries, and Docker Images</a>.</p>
<p>本教程会部署 <a target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric-samples/tree/master/asset-transfer-secured-agreement/chaincode-go">secured asset transfer sample</a> 来演示如何在两个组织之间转移私有资产而不公开共享数据。</p>
<h2 id="Scenario-requirements（方案要求）">Scenario requirements（方案要求）</h2>
<p>The private asset transfer scenario is bound by the following requirements:</p>
<ul>
<li>An asset may be issued by the first owner’s organization (in the real world issuance may be restricted to some authority that certifies an asset’s properties).</li>
<li>Ownership is managed at the organization level (the Fabric permissioning scheme would equally support ownership at an individual identity level within an organization).</li>
<li>The asset identifier and owner is stored as public channel data for all channel members to see.</li>
<li>The asset metadata properties however are private information known only to the asset owner (and prior owners).</li>
<li>An interested buyer will want to verify an asset’s private properties.</li>
<li>An interested buyer will want to verify an asset’s provenance, specifically the asset’s origin and chain of custody. They will also want to verify that the asset has not changed since issuance, and that all prior transfers have been legitimate.</li>
<li>To transfer an asset, a buyer and seller must first agree on the sales price.</li>
<li>Only the current owner may transfer their asset to another organization.</li>
<li>The actual private asset transfer must verify that the legitimate asset is being transferred, and verify that the price has been agreed to. Both buyer and seller must endorse the transfer.</li>
</ul>
<p>私有资产交易方案受以下要求约束：</p>
<ul>
<li>一个资产可能由第一个拥有者的组织发行（在现实世界中，可能只能由某个权威的可以证明资产属性的组织来发行）。</li>
<li>所有权是在组织级别进行管理的（Fabric许可方案将同样支持组织内个人身份级别的所有权）。</li>
<li>资产的ID和所有人作为可以被channel上的所有成员可见的公共数据被存储。</li>
<li>但是资产的元数据作为私有信息，只能被资产的所有者看到（也包括前所有者）。</li>
<li>有兴趣的买家将希望验证资产的私有属性。</li>
<li>有兴趣的买家将希望验证资产的出处，特别是资产的来源和产销监管链。他们还希望验证资产自从发行之后没有被篡改过，并且这个资产的前面的所有交易都是合法的。</li>
<li>在资产交易之前，买卖双方必须对资产的价格达成一致。</li>
<li>只有当前拥有者可以把他们的资产转让给另一个组织。</li>
<li>实际的私有资产交易必须确认合法资产正在转让，并确认双方已经对价格达成一致。买卖双方都必须对交易进行背书。</li>
</ul>
<h2 id="How-privacy-is-maintained（如何保持隐私性）">How privacy is maintained（如何保持隐私性）</h2>
<p>The smart contract uses the following techniques to ensure that the asset properties remain private:</p>
<ul>
<li>The asset metadata properties are stored in the current owning organization’s implicit private data collection on the organization’s peers only. Each organization on a Fabric channel has a private data collection that their own organization can use. This collection is <em>implicit</em> because it does not need to be explicitly defined in the chaincode.</li>
<li>Although a hash of the private properties is automatically stored on-chain for all channel members to see, a random salt is included in the private properties so that other channel members cannot guess the private data pre-image through a dictionary attack.</li>
<li>Smart contract requests utilize the transient field for private data so that private data does not get included in the final on-chain transaction.</li>
<li>Private data queries must originate from a client whose org id matches the peer’s org id, which must be the same as the asset owner’s org id.</li>
</ul>
<p>智能合约使用以下技术来确保资产属性保持隐私：</p>
<ul>
<li>资产元数据属性仅存储在当前拥有组织的节点的隐式私有数据集合中。每个组织在Fabric通道上都有一个只能由组织自己可以使用的私有数据集合。该集合是隐式的，因为不需要在链码中显式定义它。</li>
<li>虽然私有属性的hash值被自动保存在链上然后通道上所有成员都可以看到，但是私有属性中包含随机盐，因此其他的通道成员无法通过字典攻击猜测私有数据原像。</li>
<li>智能合约请求将瞬态字段用于私有数据，因此私有数据不会包含在最终的链上交易中。</li>
<li>对私有数据的查询必须来自组织ID与peer的组织ID一致的客户端，并且该客户端的ID必须与资产所有者的组织ID相同。</li>
</ul>
<h2 id="How-the-transfer-is-implemented（交易是如何实施的）">How the transfer is implemented（交易是如何实施的）</h2>
<p>Before we start using the private asset transfer smart contract we will provide an overview of the transaction flow and how Fabric features are used to protect the asset created on the blockchain:</p>
<p>在我们开始使用私有资产交易的智能合约之前，我们将概述交易流程以及如何使用Fabric功能来保护在区块链上创建的资产：</p>
<h3 id="Creating-the-asset（创建资产）">Creating the asset（创建资产）</h3>
<p>The private asset transfer smart contract is deployed with an endorsement policy that requires an endorsement from any channel member. This allows any organization to create an asset that they own without requiring an endorsement from other channel members. The creation of the asset is the only transaction that uses the chaincode level endorsement policy. Transactions that update or transfer existing assets will be governed by state based endorsement policies or the endorsement policies of private data collections. Note that in other scenarios, you may want an issuing authority to also endorse create transactions.</p>
<p>私有资产交易智能合约在部署时有一个背书策略，这个背书策略是：不需要任何渠道成员的认可。这样任何组织都可以创建属于他们自己的资产，而不需要其他的通道成员批准。资产的创建是唯一使用链码级背书策略的交易。更新或交易现有资产的交易将受基于状态认可政策或私有数据集合认可政策的约束。注意在其他情况下，你可能想要一个发行机构也认可创建交易。</p>
<p>The smart contract uses the following Fabric features to ensure that the asset can only be updated or transferred by the organization that owns the asset:</p>
<ul>
<li>When the asset is created, the smart contract gets the MSP ID of the organization that submitted the request, and stores the MSP ID as the owner in the asset key/value in the public chaincode world state. Subsequent smart contract requests to update or transfer the asset will use access control logic to verify that the requesting client is from the same organization. Note that in other scenarios, the ownership could be based on a specific client identity within an organization, rather than an organization itself.</li>
<li>Also when the asset is created, the smart contract sets a state based endorsement policy for the asset key. The state based policy specifies that a peer from the organization that owns the asset must endorse a subsequent request to update or transfer the asset. This prevents any other organization from updating or transferring the asset using a smart contract that has been maliciously altered on their own peers.</li>
</ul>
<p>智能合约使用以下的Fabric功能来确保资产只能由拥有它的组织进行更新和交易：</p>
<ul>
<li>在资产创建后，智能合约会获取提交请求的组织的MSP ID ，并且把这个MSP ID作为资产的拥有者存储在公共链码世界状态的key/value中。后续的更新或交易资产的智能合约请求将会使用访问控制逻辑来验证发出请求的客户端来自同一个组织。请注意在其他情况下，所有权可以基于组织内的特定客户端身份，而不是组织本身。</li>
<li>同样，在创建资产时，智能合约会为资产密钥设置基于状态的背书策略。基于状态的策略指定拥有资产的组织中的peer节点必须认可后续的更新或转让资产的请求。这样可以防止任何其他组织利用恶意更改的智能合约来更改和交易资产。</li>
</ul>
<h3 id="Agreeing-to-the-transfer（同意交易）">Agreeing to the transfer（同意交易）</h3>
<p>After a asset is created, channel members can use the smart contract to agree to transfer the asset:</p>
<ul>
<li>The owner of the asset can change the description in the public ownership record, for example to advertise that the asset is for sale. Smart contract access control enforces that this change needs to be submitted from a member of the asset owner organization. The state based endorsement policy enforces that this description change must be endorsed by a peer from the owner’s organization.</li>
</ul>
<p>在资产创建之后，通道上的成员可以使用智能合约来同意交易资产：</p>
<ul>
<li>资产的拥有者可以更改公共记录上的描述，例如广告说这个资产要卖出。智能合约访问控制强制要求此更改需要从拥有此资产的组织的成员提交。基于状态的背书策略规定，此描述更改必须得到拥有资产的组织的成员确认。</li>
</ul>
<p>The asset owner and the asset buyer agree to transfer the asset for a certain price:</p>
<ul>
<li>The price agreed to by the buyer and the seller is stored in each organization’s implicit private data collection. The private data collection keeps the agreed price secret from other members of the channel. The endorsement policy of the private data collection ensures that the respective organization’s peer endorsed the price agreement, and the smart contract access control logic ensures that the price agreement was submitted by a client of the associated organization.</li>
<li>A hash of each price agreement is stored on the ledger. The two hashes will match only if the two organizations have agreed to the same price. This allows the organizations to verify that they have come to agreement on the transfer details before the transfer takes place. A random trade id is added to the price agreement, which serves as a <em>salt</em> to ensure that other channel members can not use the hash on the ledger to guess the price.</li>
</ul>
<p>资产所有者和资产购买者同意以一定价格交易资产：</p>
<ul>
<li>买卖双方都同意的价格被存储在他们各自的隐式私有数据集合中。私有数据集合保证成交价格对通道上的其他成员来说是私密的。私有数据集合背书策略确保各自组织的peer节点对价格达成了一致，智能合约访问控制逻辑确保价格协议是由与组织有关联的客户端提交的。</li>
<li>交易双方生成的价格协议的hash值被存储在了账本上。只有在两个组织同意同一个价格时，这两个hash值才会匹配。这使组织能够在转移发生之前验证他们已就转移细节达成协议。价格协议中添加了随机交易ID，这是确保通道其他成员不能使用账本上的哈希值来猜测价格的一种盐。</li>
</ul>
<h3 id="Transferring-the-asset（交易资产）">Transferring the asset（交易资产）</h3>
<p>After the two organizations have agreed to the same price, the asset owner can use the transfer function to transfer the asset to the buyer:</p>
<ul>
<li>Smart contract access control ensures that the transfer must be initiated by a member of the organization that owns the asset.</li>
<li>The transfer function verifies that the asset’s private immutable properties passed to the transfer function matches the on chain hash of the asset data in private collection, to ensure that the asset owner is <em>selling</em> the same asset that they own.</li>
<li>The transfer function uses the hash of the price agreement on the ledger to ensure that both organizations have agreed to the same price.</li>
<li>If the transfer conditions are met, the transfer function adds the asset to the implicit private data collection of the buyer, and deletes the asset from the collection of the seller. The transfer also updates the owner in the public ownership record.</li>
<li>Because of the endorsement policies of the seller and buyer implicit data collections, and the state based endorsement policy of the public record (requiring the seller to endorse), the transfer needs to be endorsed by peers from both buyer and seller.</li>
<li>The state based endorsement policy of the public asset record is updated so that only a peer of the new owner of the asset can update or sell their new asset.</li>
<li>The price agreements are also deleted from both the seller and buyer implicit private data collection, and a sales receipt is created in each private data collection.</li>
</ul>
<p>在两个组织已经对相同的价格达成一致之后，资产的拥有者可以使用转让方法来把资产转让给买方：</p>
<ul>
<li>智能合约访问控制确保转账必须由拥有资产的组织的成员来发起</li>
<li>转账方法验证传递给它的资产的私有不可变属性是否与私有集合中资产数据的链上哈希匹配，确保资产所有者在出售他们拥有的相同的资产。</li>
<li>转账方法使用账本上的价格协议的hash值来确保两个组织已经同意了相同的价格。</li>
<li>如果满足转让条件，则转账函数会将资产添加到买方的隐式私有数据集合中，并且从卖方的集合中删除这个资产。转让还会更新公共所有权记录中的资产的所有者。</li>
<li>因为买卖双方隐式数据集合的背书策略和公共数据的基于状态的背书策略（要求卖方确认），所以交易需要得到买卖双方节点的认可。</li>
<li>公共资产记录的基于状态的背书策略需要更新，这样只有新的所有者的peer节点才能够更新和出售他们的新资产。</li>
<li>价格协议也从买卖双方隐式私人数据集合中删除，并且在每个私人数据集合中创建销售收据。</li>
</ul>
<h2 id="Running-the-private-asset-transfer-smart-contract（运行私有资产转账智能合约）">Running the private asset transfer smart contract（运行私有资产转账智能合约）</h2>
<p>You can use the Fabric test network to run the private asset transfer smart contract. The test network contains two peer organizations, Org1 and Org1, that operate one peer each. In this tutorial, we will deploy the smart contract to a channel of the test network joined by both organizations. We will first create an asset that is owned by Org1. After the two organizations agree on the price, we will transfer the asset from Org1 to Org2.</p>
<p>我们可以使用Fabric的test网络来运行私有资产转账智能合约。（省略。。。）我们先通过Org1组织创建一个资产，在两个组织对价格达成一致之后，我们把资产由Org1组织交易到Org2组织。</p>
<h2 id="Deploy-the-test-network（部署测试网络）">Deploy the test network（部署测试网络）</h2>
<p>请参考：<a href="https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8/">Fabric测试网络使用</a></p>
<h2 id="Deploy-the-smart-contract-部署智能合约">Deploy the smart contract(部署智能合约)</h2>
<p>You can use the test network script to deploy the secured asset transfer smart contract to the channel. Run the following command to deploy the smart contract to <code>mychannel</code>:</p>
<p>你可以使用测试网络脚本来部署安全资产交易智能合约到通道上。运行下面的命令来部署智能合约到<code>mychannel</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;network.sh deployCC -ccn secured -ccp ..&#x2F;asset-transfer-secured-agreement&#x2F;chaincode-go&#x2F; -ccl go -ccep &quot;OR(&#39;Org1MSP.peer&#39;,&#39;Org2MSP.peer&#39;)&quot;</span><br></pre></td></tr></table></figure>
<p>Note that we are using the <code>-ccep</code> flag to deploy the smart contract with an endorsement policy of <code>&quot;OR('Org1MSP.peer','Org2MSP.peer')&quot;</code>. This allows either organization to create an asset without receiving an endorsement from the other organization.</p>
<p>注意我们使用<code>-ccep</code>标志来部署智能合约，这个智能合约有一个背书策略<code>&quot;OR('Org1MSP.peer','Org2MSP.peer')&quot;</code>。者允许任意一个组织在创建一个新的资产时不需要其他组织的确认。</p>
<h3 id="Set-the-environment-variables-to-operate-as-Org2（设置环境变量以Org2的管理员身份操作）">Set the environment variables to operate as Org2（设置环境变量以Org2的管理员身份操作）</h3>
<p>略，可以使用两个终端分别以Org1和Org2组织管理员的身份操作peer。环境变量设置参考：[Fabric测试网络使用](<a href="https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8/">https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/Fabric测试网络使用/</a></p>
<p>[)</p>
<h2 id="Create-an-asset（创建一个资产）">Create an asset（创建一个资产）</h2>
<p>Any channel member can use the smart contract to create an asset that is owned by their organization. The details of the asset will be stored in a private data collection, and can only accessed by the organization that owns the asset. A public record of the asset, its owner, and a public description is stored on the channel ledger. Any channel member can access the public ownership record to see who owns the asset, and can read the description to see if the asset is for sale.</p>
<p>任何一个通道成员都可以使用这个智能合约来创建一个属于组织自己的资产。资产的详情会存储在私有数据集合中，并且只能由拥有资产的组织访问。资产，其所有者和公共描述的公共记录存储在通道账本中。任何通道成员都可以访问公共记录来查看谁拥有这个资产，并且可以查看描述来判断资产是否在出售。</p>
<h3 id="Operate-from-the-Org1-terminal（通过Org1的终端操作）">Operate from the Org1 terminal（通过Org1的终端操作）</h3>
<p>Before we create the asset, we need to specify the details of what our asset will be. Issue the following command to create a JSON that will describe the asset. The <code>&quot;salt&quot;</code> parameter is a random string that would prevent another member of the channel from guessing the asset using the hash on the ledger. If there was no salt, a user could theoretically guess asset parameters until the hash of the of the guess and the hash on the ledger matched (this is known as a dictionary attack). This string is encoded in Base64 format so that it can be passed to the creation transaction as transient data.</p>
<p>在创建资产之前，我们需要指定资产的详细信息。通过下面的命令来创建一个JSON来描述资产。<code>&quot;salt&quot;</code>参数是一个随机字符串来防止通道上的另一个成员通过账本上的hash值来猜测这个资产。如果没有盐，理论上用户可以猜测资产参数，直到猜测的哈希值和账本的哈希值匹配（这称为字典攻击）为止。该字符串以Base64格式编码，因此可以作为临时数据传递给创建交易。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PROPERTIES=$(echo -n &quot;&#123;\&quot;object_type\&quot;:\&quot;asset_properties\&quot;,\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;color\&quot;:\&quot;blue\&quot;,\&quot;size\&quot;:35,\&quot;salt\&quot;:\&quot;a94a8fe5ccb19ba61c4c0873d391e987982fbbd3\&quot;&#125;&quot; | base64 | tr -d \\n)</span><br></pre></td></tr></table></figure>
<p>We can now use the following command to create a asset that belongs to Org1:</p>
<p>我们现在可以使用下面的命令来创建一个属于Org1组织的资产：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;CreateAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;, &quot;A new asset for Org1MSP&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>We can can query the Org1 implicit data collection to see the asset that was created:</p>
<p>我们可以查询Org1组织的隐私数据集合来查看创建的资产：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>When successful, the command will return the following result:</p>
<p>如果成功，命令会返回下面的结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;object_type&quot;</span>: <span class="string">&quot;asset_properties&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;asset_id&quot;</span>: <span class="string">&quot;asset1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;blue&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;size&quot;</span>: <span class="number">35</span>,</span><br><span class="line">  <span class="attr">&quot;salt&quot;</span>: <span class="string">&quot;a94a8fe5ccb19ba61c4c0873d391e987982fbbd3&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can also query the ledger to see the public ownership record:</p>
<p>我们还可以查询账本来查看公共记录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>The command will return the record that the asset1 is owned by Org1:</p>
<p>这个命令会返回数据说明资产asset1属于Org1：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;Org1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;A new asset for Org1MSP&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Because the market for assets is hot, Org1 wants to flip this asset and put it up for sale. As the asset owner, Org1 can update the public description to advertise that the asset is for sale. Run the following command to change the asset description:</p>
<p>因为资产市场很热，所以Org1希望翻转该资产并将其出售。作为资产的拥有者，Org1组织可以更新公共描述来广告说资产在出售。运行下面的命令来更新资产描述：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;This asset is for sale&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>Query the ledger again to see the updated description:</p>
<p>重新查询账本来查看更新后的描述：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>We can now see that the asset is for sale:</p>
<p>我们现在可以看到这个资产在出售：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;Org1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;This asset is for sale&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/transfer_assets_1.png" alt="transfer_assets_1"></p>
<p><em>Figure 1: When Org1 creates an asset that they own, the asset details are stored in the Org1 implicit data collection on the Org1 peer. The public ownership record is stored in the channel world state, and is stored on both the Org1 and Org2 peers. A hash of the asset key and a hash the asset details are also visible in the channel world state and are stored on the peers of both organizations.</em></p>
<p><em>图片1:当组织Org1创建了一个属于他们的资产时，资产的细节保存在属于组织Org1的peer的隐式数据集合中。公共的记录被保存在通道的世界状态，并且保存在组织Org1和Org2的peer节点。资产的key的hash和资产详情的hash在通道的世界状态是可访问的，并且存储在所有组织的peer节点。</em></p>
<h3 id="Operate-from-the-Org2-terminal（通过组织Org2的终端操作）">Operate from the Org2 terminal（通过组织Org2的终端操作）</h3>
<p>If we operate from the Org2 terminal, we can use the smart contract query the public asset data:</p>
<p>如果我们通过组织Org2的终端操作，我们可以使用智能合约来查询公共的资产数据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>From this query, Org2 learns that asset1 is for sale（通过这个查询，组织Org2知道了资产asset1正在出售）:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;Org1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;This asset is for sale&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>In a real chaincode you may want to query for all assets for sale, by using a JSON query, or by creating a different sale key and using a key range query to find the assets currently for sale.</em> Any changes to the public description of the asset owned by Org1 needs to be endorsed by Org1. The endorsement policy is reinforced by an access control policy within the chaincode that any update needs to be submitted by the organization that owns the asset. Lets see what happens if Org2 tried to change the public description as a prank:</p>
<p>*在真实的链码中，您可能希望通过使用JSON查询或通过创建其他销售密钥并使用密钥的范围来查找当前待售资产，以查询所有待售资产。*所有属于组织Org1的资产的公共描述在进行任何更改时都必须得到组织Org1的认可。链码中的访问控制策略加强了背书策略，任何更新都必须由来自于资产拥有者的组织来提交。让我们看看如果Org2试图以恶作剧方式更改公共描述会发生什么：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;the worst asset&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>The smart contract does not allow Org2 to access the public description of the asset.</p>
<p>智能合约不允许组织Org2访问这个资产的公共描述。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;a client from Org2MSP cannot update the description of a asset owned by Org1MSP&quot;</span><br></pre></td></tr></table></figure>
<h2 id="Agree-to-sell-the-asset-允许出售资产">Agree to sell the asset(允许出售资产)</h2>
<p>To sell an asset, both the buyer and the seller must agree on an asset price. Each party stores the price that they agree to in their own private data collection. The private asset transfer smart contract enforces that both parties need to agree to the same price before the asset can be transferred.</p>
<p>为了出售资产。买卖双方都必须同意相同的资产价格。每一方都需要在他们的私有数据集合中保存他们同意的价格。私有资产交易智能合约强制双方必须同意相同的价格才能转让资产。</p>
<h2 id="Agree-to-sell-as-Org1（以Org1的身份同意出售）">Agree to sell as Org1（以Org1的身份同意出售）</h2>
<p>Operate from the Org1 terminal. Org1 will agree to set the asset price as 110 dollars. The <code>trade_id</code> is used as salt to prevent a channel member that is not a buyer or a seller from guessing the price. This value needs to be passed out of band, through email or other communication, between the buyer and the seller. The buyer and the seller can also add salt to the asset key to prevent other members of the channel from guessing which asset is for sale.</p>
<p>通过组织Org1的终端进行操作。Org1同意将资产价格设置为110美元。trade_id用作盐以防止不是买家或卖家的通道成员猜测价格。这个价格需要通过买卖双方之间以电子邮件或其他通信方式在账本外传递。买卖双方还可以对资产的key进行“加盐”，以防止渠道的其他成员猜测要出售的资产。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;trade_id\&quot;:\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\&quot;,\&quot;price\&quot;:110&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>We can query the Org1 private data collection to read the agreed to selling price:</p>
<p>我们可以查询组织Org1的私有数据集合来读取同意的销售价格：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetSalesPrice&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="Agree-to-buy-as-Org2-以Org2的身份同意购买">Agree to buy as Org2(以Org2的身份同意购买)</h2>
<p>Operate from the Org2 terminal. Run the following command to verify the asset properties before agreeing to buy. The asset properties and salt would be passed out of band, through email or other communication, between the buyer and seller.</p>
<p>通过Org2的终端操作。运行下面的命令在同意购买之前验证资产的属性。资产的属性和盐会在区块链账本外在买卖双方之间通过邮件或者其他方式进行传递。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PROPERTIES=$(echo -n &quot;&#123;\&quot;object_type\&quot;:\&quot;asset_properties\&quot;,\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;color\&quot;:\&quot;blue\&quot;,\&quot;size\&quot;:35,\&quot;salt\&quot;:\&quot;a94a8fe5ccb19ba61c4c0873d391e987982fbbd3\&quot;&#125;&quot; | base64)</span><br><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;VerifyAssetProperties&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>Run the following command to agree to buy asset1 for 100 dollars. As of now, Org2 will agree to a different price than Org2. Don’t worry, the two organizations will agree to the same price in a future step. However, we we can use this temporary disagreement as a test of what happens if the buyer and the seller agree to a different price. Org2 needs to use the same <code>trade_id</code> as Org1.</p>
<p>使用下面的命令来同意以100刀的价格购买asset1。现在Org2同意了一个与Org1不同的价格。不要担心，这两个组织会在接下来的步骤同意相同的价格。但是我们通过临时的分歧来测试如果买方和卖方同意了不同的价格将会发生什么。Org2需要使用与Org1相同的 <code>trade_id</code> 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;trade_id\&quot;:\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\&quot;,\&quot;price\&quot;:100&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToBuy&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>You can read the agreed purchase price from the Org2 implicit data collection:</p>
<p>您可以从Org2隐式数据集合中读取约定的购买价格：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetBidPrice&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/transfer_assets_2.png" alt="transfer_assets_2"></p>
<p><em>Figure 2: After Org1 and Org2 agree to transfer the asset, the price agreed to by each organization is stored in their private data collections. A composite key for the seller and the buyer is used to prevent a collision with the asset details and asset ownership record. The price that is agreed to is only stored on the peers of each organization. However, the hash of both agreements is stored in the channel world state on every peer joined to the channel.</em></p>
<p><em>图2:在Org1和Org2同意交易这个资产，每个组织的同意的价格被存储在他们的私有数据集合中。买卖双方的组合键用于防止与资产详细信息和资产所有权记录发生冲突。已经同意的价格只是存储在双方组织的peer节点。但是两个协议的hash值被存储在加入通道的所有peer节点的通道的世界状态中。</em></p>
<h2 id="Transfer-the-asset-from-Org1-to-Org2（把资产从Org1交易到Org2）">Transfer the asset from Org1 to Org2（把资产从Org1交易到Org2）</h2>
<p>After both organizations have agreed to their price, Org1 can attempt to transfer the asset to Org2. The private asset transfer function in the smart contract uses the hash on the ledger to check that both organizations have agreed to the same price. The function will also use the hash of the private asset details to check that the asset that is transferred is the same asset that Org1 owns.</p>
<p>在双方组织都同意了他们的价格之后，Org1可以尝试将资产交易给Org2。在智能合约中的私有资产交易方法使用账本上的hash来检查两个组织是否同意了相同的价格。这个方法也会使用私有资产详情的hash值来检查被交易的资产与属于Org1的资产是同一笔资产。</p>
<h3 id="Transfer-the-asset-as-Org1（以Org1的身份交易资产）">Transfer the asset as Org1（以Org1的身份交易资产）</h3>
<p>Operate from the Org1 terminal. The owner of the asset needs to initiate the transfer. Note that the command below uses the <code>--peerAddresses</code> flag to target the peers of both Org1 and Org2. Both organizations need to endorse the transfer. <em>Also note that the asset properties and price are passed in the transfer request as transient properties. These are passed so that the current owner can be sure that the correct asset is transferred for the correct price. These properties will be checked against the on-chain hashes by both endorsers.</em></p>
<p>通过Org1的终端操作。资产的所有者需要发起这个交易。注意下面的命令使用<code>--peerAddresses</code> 标志来指定Org1和Org2的peer节点。两个组织都需要确认这个交易。<em>另外请注意，资产属性和价格在交易请求中作为临时属性传递。传递这些是为了当前的拥有者可以确保以当前的价格来转让当前的资产。两个背书者将对照链上哈希检查这些属性。</em></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;Org2MSP&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;,\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot; --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br></pre></td></tr></table></figure>
<p>Because the two organizations have not agreed to the same price, the transfer cannot be completed:</p>
<p>因为两个组织同意的价格不一致，这个交易不能完成：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;failed transfer verification: hash 0fc413250501855af7c9896af00993b973510995fb10d56cddbb85ca47bd5dba for passed price JSON &#123;\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;trade_id\&quot;:\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\&quot;,\&quot;price\&quot;:110&#125; does not match on-chain hash 84b0d57eaa5c77076483ae8f482c96a64912c47df5541451e94fb7698bf37ee9, buyer hasn&#x27;t agreed to the passed trade id and price&quot;</span><br></pre></td></tr></table></figure>
<p>As a result, Org1 and Org2 come to a new agreement on the price at which the asset will be purchased. Org1 drops the price of the asset to 100:</p>
<p>结果，Org1和Org2就购买资产的价格达成了新协议。 Org1将资产价格降至100：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;trade_id\&quot;:\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\&quot;,\&quot;price\&quot;:100&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>Now that the buyer and seller have agreed to the same price, Org1 can transfer the asset to Org2.</p>
<p>现在买卖双方已经同意了相同的价格，Org1可以将资产交易给Org2。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;Org2MSP&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;,\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot; --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br></pre></td></tr></table></figure>
<p>You can query the asset ownership record to verify that the transfer was successful.</p>
<p>你可以查询资产的归属信息来验证交易已经成功.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>The record now lists Org2 as the asset owner:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;Org2MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;This asset is for sale&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/transfer_assets_3.png" alt="transfer_assets_3"></p>
<p><em>Figure 3: After the asset is transferred, the asset details are placed in the Org2 implicit data collection and deleted from the Org1 implicit data collection. As a result, the asset details are now only stored on the Org2 peer. The asset ownership record on the ledger is updated to reflect that the asset is owned by Org1.</em></p>
<p><em>图3:在资产交易之后，资产细节存在于Org2的隐式数据集合并且从Org1的隐式数据集合中被删除。结果，资产的私有信息值保存在Org2的peer节点。在账本上的资产的归属信息也被更新，以反映资产归Org2所有。</em></p>
<h3 id="Update-the-asset-description-as-Org2（以Org2的身份更新资产描述）">Update the asset description as Org2（以Org2的身份更新资产描述）</h3>
<p>Operate from the Org2 terminal. Now that Org2 owns the asset, we can read the asset details from the Org2 implicit data collection:</p>
<p>通过Org2的终端操作，现在Org2拥有这个资产，我们可以通过Org2的隐式数据集合读取资产的详情：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>Org2 can now update the asset public description（Org2现在可以更新资产的公共描述）:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;This asset is not for sale&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>Query the ledger to verify that the asset is no longer for sale:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="Clean-up">Clean up</h2>
<p>When you are finished transferring assets, you can bring down the test network. The command will remove all the nodes of the test network, and delete any ledger data that you created:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;network.sh down</span><br></pre></td></tr></table></figure>
<h2 id="流程图">流程图</h2>
<p>自己的理解画的流程图如下：</p>
<p><img src="/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/apple/Desktop/%E7%A7%81%E6%9C%89%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%98%93%E5%90%88%E7%BA%A6%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg" alt="私有数据交易流程图"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/guozhe001">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7"><span class="toc-number">1.</span> <span class="toc-text">在Fabric中交易受保护的资产</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Scenario-requirements%EF%BC%88%E6%96%B9%E6%A1%88%E8%A6%81%E6%B1%82%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">Scenario requirements（方案要求）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-privacy-is-maintained%EF%BC%88%E5%A6%82%E4%BD%95%E4%BF%9D%E6%8C%81%E9%9A%90%E7%A7%81%E6%80%A7%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">How privacy is maintained（如何保持隐私性）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-the-transfer-is-implemented%EF%BC%88%E4%BA%A4%E6%98%93%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E6%96%BD%E7%9A%84%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">How the transfer is implemented（交易是如何实施的）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-the-asset%EF%BC%88%E5%88%9B%E5%BB%BA%E8%B5%84%E4%BA%A7%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">Creating the asset（创建资产）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Agreeing-to-the-transfer%EF%BC%88%E5%90%8C%E6%84%8F%E4%BA%A4%E6%98%93%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">Agreeing to the transfer（同意交易）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Transferring-the-asset%EF%BC%88%E4%BA%A4%E6%98%93%E8%B5%84%E4%BA%A7%EF%BC%89"><span class="toc-number">1.3.3.</span> <span class="toc-text">Transferring the asset（交易资产）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Running-the-private-asset-transfer-smart-contract%EF%BC%88%E8%BF%90%E8%A1%8C%E7%A7%81%E6%9C%89%E8%B5%84%E4%BA%A7%E8%BD%AC%E8%B4%A6%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">Running the private asset transfer smart contract（运行私有资产转账智能合约）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deploy-the-test-network%EF%BC%88%E9%83%A8%E7%BD%B2%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">Deploy the test network（部署测试网络）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deploy-the-smart-contract-%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="toc-number">1.6.</span> <span class="toc-text">Deploy the smart contract(部署智能合约)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-the-environment-variables-to-operate-as-Org2%EF%BC%88%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%BB%A5Org2%E7%9A%84%E7%AE%A1%E7%90%86%E5%91%98%E8%BA%AB%E4%BB%BD%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">1.6.1.</span> <span class="toc-text">Set the environment variables to operate as Org2（设置环境变量以Org2的管理员身份操作）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create-an-asset%EF%BC%88%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%B5%84%E4%BA%A7%EF%BC%89"><span class="toc-number">1.7.</span> <span class="toc-text">Create an asset（创建一个资产）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Operate-from-the-Org1-terminal%EF%BC%88%E9%80%9A%E8%BF%87Org1%E7%9A%84%E7%BB%88%E7%AB%AF%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">1.7.1.</span> <span class="toc-text">Operate from the Org1 terminal（通过Org1的终端操作）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Operate-from-the-Org2-terminal%EF%BC%88%E9%80%9A%E8%BF%87%E7%BB%84%E7%BB%87Org2%E7%9A%84%E7%BB%88%E7%AB%AF%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="toc-number">1.7.2.</span> <span class="toc-text">Operate from the Org2 terminal（通过组织Org2的终端操作）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Agree-to-sell-the-asset-%E5%85%81%E8%AE%B8%E5%87%BA%E5%94%AE%E8%B5%84%E4%BA%A7"><span class="toc-number">1.8.</span> <span class="toc-text">Agree to sell the asset(允许出售资产)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Agree-to-sell-as-Org1%EF%BC%88%E4%BB%A5Org1%E7%9A%84%E8%BA%AB%E4%BB%BD%E5%90%8C%E6%84%8F%E5%87%BA%E5%94%AE%EF%BC%89"><span class="toc-number">1.9.</span> <span class="toc-text">Agree to sell as Org1（以Org1的身份同意出售）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Agree-to-buy-as-Org2-%E4%BB%A5Org2%E7%9A%84%E8%BA%AB%E4%BB%BD%E5%90%8C%E6%84%8F%E8%B4%AD%E4%B9%B0"><span class="toc-number">1.10.</span> <span class="toc-text">Agree to buy as Org2(以Org2的身份同意购买)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Transfer-the-asset-from-Org1-to-Org2%EF%BC%88%E6%8A%8A%E8%B5%84%E4%BA%A7%E4%BB%8EOrg1%E4%BA%A4%E6%98%93%E5%88%B0Org2%EF%BC%89"><span class="toc-number">1.11.</span> <span class="toc-text">Transfer the asset from Org1 to Org2（把资产从Org1交易到Org2）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Transfer-the-asset-as-Org1%EF%BC%88%E4%BB%A5Org1%E7%9A%84%E8%BA%AB%E4%BB%BD%E4%BA%A4%E6%98%93%E8%B5%84%E4%BA%A7%EF%BC%89"><span class="toc-number">1.11.1.</span> <span class="toc-text">Transfer the asset as Org1（以Org1的身份交易资产）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Update-the-asset-description-as-Org2%EF%BC%88%E4%BB%A5Org2%E7%9A%84%E8%BA%AB%E4%BB%BD%E6%9B%B4%E6%96%B0%E8%B5%84%E4%BA%A7%E6%8F%8F%E8%BF%B0%EF%BC%89"><span class="toc-number">1.11.2.</span> <span class="toc-text">Update the asset description as Org2（以Org2的身份更新资产描述）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clean-up"><span class="toc-number">1.12.</span> <span class="toc-text">Clean up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">1.13.</span> <span class="toc-text">流程图</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&text=在Fabric中交易受保护的资产"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&title=在Fabric中交易受保护的资产"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&is_video=false&description=在Fabric中交易受保护的资产"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=在Fabric中交易受保护的资产&body=Check out this article: https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&title=在Fabric中交易受保护的资产"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&title=在Fabric中交易受保护的资产"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&title=在Fabric中交易受保护的资产"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&title=在Fabric中交易受保护的资产"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&name=在Fabric中交易受保护的资产&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://guozhe001.github.io/2024/11/22/blockchain/fabric/how_to/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/&t=在Fabric中交易受保护的资产"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2024
    guozhe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/guozhe001">项目</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
